(function(t,e){typeof exports==="object"&&typeof module!=="undefined"?module.exports=e(require("https://d3js.org/d3.v4.min")):typeof define==="function"&&define.amd?define(["https://d3js.org/d3.v4.min"],e):t.jelly=e(t.d3)})(this,function(t){"use strict";var e=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol==="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};var i=function(t,e){if(!(t instanceof e)){throw new TypeError("Cannot call a class as a function")}};var r=function(){function t(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||false;r.configurable=true;if("value"in r)r.writable=true;Object.defineProperty(t,r.key,r)}}return function(e,i,r){if(i)t(e.prototype,i);if(r)t(e,r);return e}}();var n=function t(e,i,r){if(e===null)e=Function.prototype;var n=Object.getOwnPropertyDescriptor(e,i);if(n===undefined){var a=Object.getPrototypeOf(e);if(a===null){return undefined}else{return t(a,i,r)}}else if("value"in n){return n.value}else{var s=n.get;if(s===undefined){return undefined}return s.call(r)}};var a=function(t,e){if(typeof e!=="function"&&e!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof e)}t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:false,writable:true,configurable:true}});if(e)Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e};var s=function(t,e){if(!t){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e&&(typeof e==="object"||typeof e==="function")?e:t};var o="jellychart";var l=["#50C3F7 ","#7986CB ","#BA68C8 ","#F06292 ","#FF8A65 ","#FFD54F ","#AED581 ","#4CB6AC ","#2C82A9 ","#48528A ","#803E8C ","#A6365B ","#CF6644 ","#C1A039 ","#749350 ","#32827A "];var c=function(){var e=t.format(",");var i=t.format("+,");var r=t.format(",.2f");var n=t.format("+,.2f");return function(t){var a=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(isNaN(t))return t;else if(typeof t==="string")t=+t;return(Number.isInteger(t)?a?i:e:a?n:r)(t)}}();function u(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:o;var r=t.split(" ").map(function(t){return i+"-"+t});if(e)return"."+r.join(".");else return r.join(" ")}function h(t,e){if(t.on&&typeof t.on==="function"){var i=t.on;t.on=function(){var r=void 0;try{r=i.apply(t,arguments)}catch(t){r=e.on.apply(e,arguments)}return r}}else{t.on=function(){var i=e.on.apply(e,arguments);return i===e?t:i}}return t}function f(){try{return/constructor/i.test(window.HTMLElement)||function(t){return t.toString()==="[object SafariRemoteNotification]"}(!window["safari"]||f.pushNotification)}catch(t){return false}}function d(t){return function(e){if(!arguments.length)return this.__attrs__[t];this.__attrs__[t]=e;return this}}function v(t,e){if(!t.__attrs__)t.__attrs__={};e=JSON.parse(JSON.stringify(e));for(var i in e){if(e.hasOwnProperty(i)){t.__attrs__[i]=e[i]}}}function _(t,e){for(var i in e){if(e.hasOwnProperty(i)&&!t.prototype[i]){t.prototype[i]=d(i)}}}function p(t){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return function(r){if(!arguments.length)return this.__attrs__[t];else if(typeof r==="boolean"){if(r)r=i}else if((typeof r==="undefined"?"undefined":e(r))==="object"){for(var n in i){if(i.hasOwnProperty(n)){if(!(n in r))r[n]=i[n]}}}this.__attrs__[t]=r;return this}}function g(e){return t.select("body").selectAll("#"+e).empty()}function m(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var i=t+e;while(!g(i)){e++;i=t+e}return i}function y(t){return t[0]*t[t.length-1]<0}function x(t){return new k(t)}var k=function(){function t(e){i(this,t);this.parent=e}r(t,[{key:"with",value:function t(){for(var e=arguments.length,i=Array(e),r=0;r<e;r++){i[r]=arguments[r]}return i.reduce(function(t,e){return e(t)},this.parent)}}]);return t}();function b(t){var e=function e(){return new t};e.__class__=t;return e}var w={millisecond:t.timeMillisecond,second:t.timeSecond,minute:t.timeMinute,hour:t.timeHour,day:t.timeDay,week:t.timeWeek,sunday:t.timeSunday,monday:t.timeMonday,tuesday:t.timeTuesday,wednesday:t.timeWednesday,thursday:t.timeThursday,friday:t.timeFriday,saturday:t.timeSaturday,month:t.timeMonth,year:t.timeYear,utcMillisecond:t.utcMillisecond,utcSecond:t.utcSecond,utcMinute:t.utcMinute,utcHour:t.utcHour,utcDay:t.utcDay,utcWeek:t.utcWeek,utcSunday:t.utcSunday,utcMonday:t.utcMonday,utcTuesday:t.utcTuesday,utcWednesday:t.utcWednesday,utcThursday:t.utcThursday,utcFriday:t.utcFriday,utcSaturday:t.utcSaturday,utcMonth:t.utcMonth,utcYear:t.utcYear};function z(t){this.message=t+"is not availabele to select";this.name="NotAvailableSelectorError"}function A(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"Unacceptable condtion";this.message=t;this.name="ConditionException"}function N(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"Zero in the Denominator of a Fraction";this.message=t;this.name="ZeroDenominator"}var F={sum:t.sum,mean:t.mean,variance:t.variance,min:t.min,max:t.max,median:t.median,extent:t.extent};F.values=function(t){return t};F.count=function(t){return t.length};function T(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"ascending";var e=arguments[1];return function(i,r){if(e){i=i[e];r=r[e]}if(t==="natural")return 0;else if(t==="ascending")return i.getTime()-r.getTime();else return r.getTime()-i.getTime()}}function O(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"ascending";var e=arguments[1];var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:function(t){return t};var n=/(\d+((-|\.)*\d*))/;function a(e,i){if(t==="natural")return 0;else if(t==="ascending")return e-i;else return i-e}function s(e,r){var o=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(t==="natural")return 0;if(i&&!o){var l=e.match(n),c=r.match(n);if(l&&c){return a(+l[0],+c[0])||s(e,r,true)}}if(t==="ascending")return e.localeCompare(r);return r.localeCompare(e)}function o(i,r){var n=function t(e){return function(t){if(e instanceof Date&&t instanceof Date)return e-t===0;else return t===e}};var a=e.findIndex(n(i));var s=e.findIndex(n(r));if(t==="descending")return s-a;else return a-s}return function(t,i){var n=void 0;if(!e||e.length===0){n=typeof t==="string"&&typeof i==="string"?s:a}else{n=o}return n(r(t),r(i))}}function S(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"x";var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"y";var n=e.length;var a=1/n;var s=t.sum(e,function(t){return t[i]})*a;var o=t.sum(e,function(t){return t[r]})*a;var l=t.sum(e.map(function(t){return Math.pow(t[i]-s,2)}));var c=t.sum(e.map(function(t){return Math.pow(t[r]-o,2)}));var u=t.sum(e.map(function(t){return(t[i]-s)*(t[r]-o)}));var h=u/l;var f=o-s*h;var d=Math.pow(u,2)/(l*c);return{slope:h,intercept:f,rSquare:d}}function M(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!Array.isArray(e))e=[e];t.forEach(function(t,i,r){e.forEach(function(e){var n=e.valueName();if(i===0)t.data.value[n+"-start"]=0;else t.data.value[n+"-start"]=r[i-1].data.value[n+"-end"];t.data.value[n+"-end"]=t.data.value[n+"-start"]+t.data.value[n]})});if(i){var r={};var n=t[t.length-1].data.value;e.forEach(function(t){var e=t.valueName();r[e]=n[e+"-end"]});t.forEach(function(t){e.forEach(function(e){var i=e.valueName();var n=r[i];if(n!==0){t.data.value[i+"-start"]=t.data.value[i+"-start"]/n;t.data.value[i+"-end"]=t.data.value[i+"-end"]/n}else{throw new N}})})}}function L(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"linear";var r=arguments[2];var n=i==="time"||false;if(!n){n=true;for(var a=0;a<e.length;a++){var s=e[a];if(!(s instanceof Date)){n=false;break}}}var o=void 0;if(n){o=t.scaleTime();i="time"}else{if(i==="pow")o=t.scalePow();else if(i==="log")o=t.scaleLog();else{o=t.scaleLinear();i="linear"}}o._scaleType=i;o._field=r;return o.domain(e)}function D(t,e){if(t.interval){var i=w[t.interval];e.key(function(e){return i(e[t.field])})}else if(t.format){var r=t.format;e.key(function(e){return r(e[t.field])})}else{e.key(function(e){return e[t.field]})}if(t.order==="ascending"||t.order==="descending"){e.sortKeys(O(t.order,t.orderList))}return e}function E(e,i,r){var n=this.dimensions();var a=e;var s=function s(o){var l=i?n[n.length-1-o]:n[o];if(l.interval){a.forEach(function(t){t.key=new Date(t.key)});a.sort(T(l.order,"key"));if(r&&l.format){a.forEach(function(t){t.key=l.format(t.key)})}}if(o<n.length-1)a=t.merge(e.map(function(t){return t.values}))};for(var o=0;o<n.length;o++){s(o)}return e}function C(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var a=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var s=this.data();var o=this.dimensions();var l=this.measures();var c=t.nest();for(var u=0;u<o.length;u++){var h=e?o[o.length-1-u]:o[u];D(h,c)}if(!i){var f=E.call(this,c.entries(s),e,r);return n?t.hierarchy({values:f},function(t){return t.values}).children:f}c.rollup(function(t){var e={};l.forEach(function(i){e[i.field+"-"+i.op]=F[i.op](t,function(t){return t[i.field]})});return e});var d=c.entries(s);E.call(this,d,e,r);if(n){var v=t.hierarchy({values:d},function(t){return t.values});if(a&&l.length===1){var _=l[0];v.sum(function(t){return t.value?t.value[_.field+"-"+_.op]:0})}return v.children}else{return d}}var j={customDomain:null,level:0,munged:null,target:null,format:null,field:null};var R=function(){function t(e){i(this,t);v(this,j);this.__execs__={};this.setInit(e,["field","format","customDomain"])}r(t,[{key:"setInit",value:function t(e){var i=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:[];if(e){r.forEach(function(t){if(e[t])i[t](e[t])})}return this}},{key:"axis",value:function t(i){if(!arguments)return this.__execs__.axis;if(i&&(typeof i==="undefined"?"undefined":e(i))==="object"){if(i!==this.__execs__.axis)this.__execs__.axis=i;i.field=this.mixed?this.concatFields():this.field();i.tickFormat=this.format()}return this}},{key:"toObject",value:function t(){return{field:this.field(),format:this.format(),customDomain:this.customDomain()}}}]);return t}();_(R,j);var P=" ";var B={field:"__--jelly_count_measure--__",op:"count"};var I={field:"__--jelly_mixed_measure--__",op:"mean"};var H={aggregated:false,op:"mean",mixed:false,measures:[]};var V=function(e){a(o,e);function o(t){i(this,o);var e=s(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));v(e,H);e.setInit(t,["op"]);return e}r(o,[{key:"domain",value:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var a=this.level();var s=this.munged();var o=0;var e=[];var l=this.valueName();function c(t,i){t.forEach(function(t){if(i<a){c(t.children,i+1)}else{if(r){e.push(t.data.value[l+"-start"]);e.push(t.data.value[l+"-end"])}else{e.push(t.data.value[l])}}})}c(s,o);e=t.extent(e);if(e[0]===e[1]&&!n){var u=e[0]*.2;e[0]-=u;e[1]+=u}if(i<=0)return e;var h=Math.abs(e[0]-e[1]);h*=i*.5;return[e[0]-h,e[1]+h]}},{key:"concatFields",value:function t(){if(this.mixed()){if(this.measures().length>0)return this.measures().map(function(t){return t.field}).join("-");else return""}else if(this.field()===I.field)return"";else return this.field()}},{key:"valueName",value:function t(){var e=this.field();return e+(this.mixed()||e===I.field&&this.aggregated()?"":"-"+this.op())}},{key:"toObject",value:function t(){var e=n(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"toObject",this).call(this);e.op=this.op();return e}}]);return o}(R);function G(t){return new V(t)}_(V,H);function X(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var n=this.data();var a=this.dimensions();var s=this.measures();var o=void 0;if(a.length===0){o=s.map(function(t){var e=F[t.op](n,function(e){return e[t.field]});var i={};i.key=t.field;i.value={};i.value[I.field]=e;return i})}else{o=this.aggregate(n,true,false,false);if(e){o=s.map(function(t){var e={};e.key=t.field;e.values=o.map(function(e){var i={};i.key=e.key;i.value={};i.value[I.field]=e.value[t.field+"-"+t.op];return i});return e})}else{o.forEach(function(t){t.values=s.map(function(e){var i={};i.key=e.field;i.value={};i.value[I.field]=t.value[e.field+"-"+e.op];return i});delete t.value})}}if(i){var l=t.hierarchy({values:o},function(t){return t.values});if(r){l.sum(function(t){return t.value?t.value[I.field]:0})}return l.children}else{return o}}function Y(t){if(!arguments.length)return this.__attrs__.color;if(Array.isArray(t)){this.__attrs__.color=t}else if(typeof t==="string"){this.__attrs__.color=[t]}return this}function J(t){if(!arguments.length)return this.__attrs__.colorDomain;t=t.map(function(t){if(typeof t==="string"||typeof t==="number")return{key:t};return t});this.__attrs__.colorDomain=t;return this}function W(t){if(!arguments.length)return this.__execs__.condition;this.__execs__.condition=t.call(this,this.__attrs__.dimensions,this.__attrs__.measures);return this}var K=140;function q(t,e){e=e||this.muteIntensity();t.transition().duration(K).attr("opacity",e);return this}function Z(t){t.transition().duration(K).attr("opacity",1);return this}function U(t){if(this.__execs__.legend)this.__execs__.legend.demute(t);return this}function Q(t){var i=void 0;if(typeof t==="function"){i=t}else if(typeof t==="string"){i=function e(i){return i.data.key!==t}}else if((typeof t==="undefined"?"undefined":e(t))==="object"&&t.data){i=function e(i){return i.data.key!==t.data.key}}else if((typeof t==="undefined"?"undefined":e(t))==="object"){i=function e(i){return i.data.key instanceof Date?i.data.key-t!==0:false};if(t instanceof Date)return i=function e(i){return i.data.key instanceof Date?i.data.key-t!==0:false};else i=function e(i){return i.data.key!==t}}return i}function $(t){var e=void 0;if(!arguments.length){e=this.filterNodes().classed("mute",false).call(this.demute)}else{e=this.filterNodes(Q(t));if(e.size()>0){e.classed("mute",false).call(this.demute)}}return this}function tt(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;t.selectAll(e?this.seriesName():this.nodeName()).classed("mute",false).call(this.demute)}function et(t){var e=void 0;if(!arguments.length){e=this.filterRegions();tt.call(this,e);if(this.seriesName)tt.call(this,e,true)}else{e=this.filterRegions(Q(t),true);tt.call(this,e);if(this.seriesName)tt.call(this,e,true)}return this}var it=100;function rt(i){if(typeof i==="string"){return{field:i,order:"natural",max:it}}else if((typeof i==="undefined"?"undefined":e(i))==="object"){i=Object.assign({},i);if(!i.max)i.max=it;if(!i.order)i.order="natural";if(i.format&&typeof i.format==="string"){try{i.format=t.timeFormat(i.format)}catch(e){try{i.format=t.format(i.format)}catch(t){throw t}}}return i}}function nt(t){this.__attrs__.dimensions.push(rt(t));return this}function at(t){if(!arguments.length)return this.__attrs__.dimensions;if(!Array.isArray(t)){t=[t]}this.__attrs__.dimensions=t.map(function(t){return rt(t)});return this}function st(t){var e=this.__execs__.scale;if(t in e&&e.hasOwnProperty(t)){return e[t].domain()}else{return null}}function ot(t){var e=this.nodes();if(!t||typeof t!=="function")return e;return e.filter(t)}function lt(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var r=this.regions();if(!e||typeof e!=="function")return r;if(i){r=r.filter(function(){return!t.select(this).classed("facet")})}return r.filter(e)}function ct(){if(this.multiTooltip&&this.multiTooltip())return this;this.__execs__.tooltip.hide();return this}function ut(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var e=this.offset();var i=this.width()-e.left-e.right;var r=this.height()-e.top-e.bottom;if(t)return[i,r];else return{width:i,height:r}}var ht=54;var ft=162;function dt(t){if(!arguments.length)return this.__attrs__.legend;if(t===true)this.__attrs__.legend={orient:"bottom",thickness:ht};else if(t===false)this.__attrs__.legend=null;else if((typeof t==="undefined"?"undefined":e(t))==="object"){if(!t.orient)t.orient="bottom";if(!t.thickness)t.thickness=t.orient==="bottom"||t.orient==="top"?ht:ft;this.__attrs__.legend=t}return this}function vt(t){var e=function t(e,i,r,n){e=e.slice(0,i);if(r<n)e.forEach(function(e){return e.children=t(e.children,i,r+1,n)});return e};if(!arguments.length){var i=this.__attrs__.limitKeys;if(i){var r=this.__execs__.munged;var n=this.dimensions().length;var a=e(this.aggregated()?r.children:r,i,1,n);if(this.aggregated()){r.children=a;a=r}this.__execs__.munged=a}}else{this.__attrs__.limitRows=t}return this}function _t(t){if(!arguments.length){var e=this.__attrs__.limitRows;if(e){var i=this.data();if(this.aggregated()){i.children=i.children.slice(0,e)}else{i=i.slice(0,e)}this.data(i)}}else{this.__attrs__.limitRows=t}}function pt(t,e,i){if(t[i]&&typeof t[i]==="number")e[i]=t[i]}function gt(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var i=this.__attrs__.margin;if(!arguments.length)return this.__attrs__.margin;if((typeof t==="undefined"?"undefined":e(t))==="object"){["top","right","left","bottom"].forEach(function(e){return pt(t,i,e)})}return this}function mt(i){if(typeof i==="string"){this.__attrs__.measures.push({field:i,op:"sum"})}else if((typeof i==="undefined"?"undefined":e(i))==="object"){if("format"in i&&typeof i.format==="string")i.format=t.timeFormat(i.format);this.__attrs__.measures.push(i)}return this}function yt(t,e){t=t||this.measures()[0];var i=t.field;if(!this.aggregated()||t.field!==I.field)i+="-"+t.op;return i+(e!==undefined?"-"+e:"")}function xt(i){if(!arguments.length)return this.__attrs__.measures;var r=function i(r){if(typeof r==="string"){return{field:r,op:"sum"}}else if((typeof r==="undefined"?"undefined":e(r))==="object"){if("format"in r&&typeof r.format==="string")r.format=t.timeFormat(r.format);return r}};if(Array.isArray(i)){this.__attrs__.measures=i.map(function(t){return r(t)})}else{this.__attrs__.measures=[r(i)]}return this}function kt(){var t={order:"natural"};t.field=this.measures().map(function(t){return t.field}).join("-");return t}function bt(t){if(this.__execs__.legend)this.__execs__.legend.mute(t);return this}function wt(t){var e=void 0;if(!arguments.length){e=this.filterNodes().classed("mute",true).call(this.mute,this.muteIntensity())}else if(t===null){e=this.filterNodes().classed("mute",false).call(this.demute)}else{e=this.filterNodes(Q(t));if(e.size()>0){e.classed("mute",true).call(this.mute,this.muteIntensity())}}return this}function zt(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;t.selectAll(i?this.seriesName():this.nodeName()).classed("mute",e).call(e?this.mute:this.demute,this.muteIntensity())}function At(t){var e=void 0;if(!arguments.length){e=this.filterRegions();zt.call(this,e,true);if(this.seriesName)zt.call(this,e,true,true)}else if(t===null){e=this.filterRegions();zt.call(this,e,false);if(this.seriesName)zt.call(this,e,false,true)}else{e=this.filterRegions(Q(t),true);if(e.size()>0){zt.call(this,e,true);if(this.seriesName)zt.call(this,e,true,true)}}return this}function Nt(t){var e=void 0;if(!arguments.length||t===false)return this.__attrs__.nodeName;else if(typeof t==="boolean"&&t){return e?e:e=this.__attrs__.nodeName.split(".").join(" ").trim()}else if(typeof t==="string"){this.__attrs__.nodeName=t;e=this.__attrs__.nodeName.split(".").join(" ").trim()}return this}function Ft(){return this.regions().selectAll(this.nodeName())}var Tt={top:0,right:0,bottom:0,left:0};function Ot(){if(this.zeroOffset())return Tt;var t=Object.assign({},this.zeroMargin()?Tt:this.margin());var e=this.legend();if(e)t[e.orient]+=e.thickness;return t}function St(t){if(!arguments.length)return this.__attrs__.parent;this.__attrs__.parent=t;return this}function Mt(t){return h(this,t)}function Lt(){return this.__execs__.canvas.selectAll(this.regionName())}function Dt(){this.reset();if(this.__execs__.canvas){this.__execs__.canvas.node().parentNode.parentNode.remove();this.__execs__.canvas=null}return this}function Et(t,e){t.on("click.default",function(){e.apply("selectClick",this,arguments)}).on("mouseenter.default",function(){e.apply("selectEnter",this,arguments)}).on("mouseleave.default",function(){e.apply("selectLeave",this,arguments)});return t}function Ct(){var t=this;var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;this.renderLayout(e);if(!this.__execs__.canvas)return;var i=this.__execs__.selectDispatch;var r=this.nodes();var n=this.__execs__.legend;if(r&&r.size()>0){if(this.parent()){return}r.call(Et,i).on("mouseenter.default.legend",function(e){if(n&&n.mute&&t.muteToLegend)t.muteToLegend(e)}).on("mouseleave.default.legend",function(e){if(n&&n.demute&&t.demuteToLegend)t.demuteToLegend(e)})}if(this.isFacet&&this.isFacet()){r.call(Et,i)}return this}var jt="none";function Rt(e,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var a=function t(e){e.attr("x",-r).attr("y",-r).attr("width",i.width+r*2).attr("height",i.height+r*2)};var s=e.selectAll(function(){return this.childNodes}).filter(function(){return t.select(this).classed(u("canvas-g-defs"))});if(s.empty()){s=e.append("defs").attr("class",u("canvas-g-defs")).datum(i);s.append("clipPath").attr("id",function(){return m("canvas-g-")}).attr("class",u("canvas-g-clip-path")).append("rect").attr("class",u("canvas-g-clip-path-rect")).call(a)}var o=s.select(u("canvas-g-clip-path-rect",true));if(n)o=o.transition().duration(n.duration).delay(n.delay);o.call(a)}function Pt(e,i,r){var n=r.__execs__.mark;e=t.select(e);if(e.empty())throw new z;if(e.node().tagName==="g"||e.node().tagName==="G"){if(e.select(u("canvas-g",true)).empty()){r.__execs__.canvas=e.append("g").attr("class",u("canvas-g"));r.__execs__.canvas.append("g").attr("class",u("regions"))}else if(!this.__execs__.canvas){r.__execs__.canvas=e.select(u("canvas-g",true))}n.set(r.__execs__.canvas.node(),{x:i.left,y:i.right});r.__execs__.canvas.attr("transform","translate("+[i.left,i.right]+")")}}function Bt(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var i=this.container();if(i===null)return null;var r=this.offset();var n=this.innerSize();if(typeof i!=="string"){Pt(i,r,this);if(this.__execs__.canvas){this.__execs__.canvas.datum(this.__execs__.munged);this.__execs__.canvas.call(Rt,n,e,this.transition());return}}var a=void 0;if(this.__execs__.canvas){a=t.select(this.__execs__.canvas.node().parentNode)}else{var s=t.select(i);if(s.empty()){throw new z}a=s.select(u("frame",true)).select("svg");this.__execs__.canvas=a.append("g").attr("class",u("canvas-g")).attr("transform","translate("+[r.left,r.top]+")");this.__execs__.canvas.append("rect").attr("class",u("background")).style("fill",jt);this.__execs__.canvas.append("g").attr("class",u("regions"))}var o=this.transition();var l=this.__execs__.canvas;l.style("pointer-events","none");if(o){l.transition().duration(o.duration).delay(o.delay).attr("transform","translate("+[r.left,r.top]+")").on("end",function(){t.select(this).style("pointer-events","all")})}else{l.attr("transform","translate("+[r.left,r.top]+")").style("pointer-events","all")}l.select(u("background",true)).attr("width",n.width).attr("height",n.height);l.datum(this.__execs__.munged).call(Rt,n,e,this.transition());return this}function It(t,e){t.attr("width",e.width()).attr("height",e.height()).attr("viewBox","0 0 "+e.width()+" "+e.height());return t}function Ht(t,e){e.__execs__.hidden=t.append("g").attr("class",u("hidden-g")).style("visibility","hidden");return t}function Vt(){var e=this.container();var i=t.select(e);if(i.empty())throw new z;if(typeof e!=="string"){if(i.node().tagName==="g"||i.node().tagName==="G"){if(i.selectAll(u("hidden-g",true)).empty()){i.call(Ht,this)}else if(!this.__execs__.hidden){this.__execs__.hidden=i.select(u("hidden-g",true))}return}}var r=void 0;if(!this.__execs__.canvas){r=i.append("div").attr("class",u("frame"));if(this.name())r.attr("id","jelly-chart-id-"+this.name());r=r.append("svg");r.call(Ht,this);r.call(It,this)}else{r=t.select(this.__execs__.canvas.node().parentNode)}i.select(u("frame",true)).style("width",this.width()+"px").style("height",this.height()+"px");if(this.transition())r=r.transition().duration(this.transition().duration).delay(this.transition().delay);r.call(It,this);return this}var Gt={"font-family":"sans-serif","font-size":11,"font-weight":"normal","font-style":"normal"};var Xt=u("legend-area-clip-path");var Yt=u("legend-label-clip-path");var Jt=["top","bottom"];var Wt=180;var Kt={color:"#485465",muteIntensity:.3,font:Gt,format:null,height:0,orient:Jt[1],scale:null,showTooltip:true,title:null,transition:null,width:0,x:0,y:0};var qt=function e(){i(this,e);this.__attrs__=JSON.parse(JSON.stringify(Kt));this.__execs__={legend:null};this.__execs__.dispatch=t.dispatch("selectClick","selectEnter","selectLeave");h(this,this.__execs__.dispatch)};function Zt(){return new qt}function Ut(){return this.orient()==="bottom"||this.orient()==="top"}function Qt(t){var e=this.font();for(var i in e){t.style(i,i==="font-size"?e[i]+"px":e[i])}}function $t(e,i,r){var n=i.isHorizontal();var a=i.width();var s=i.height();var o=i.labelHeight();var l=i.labelPadding();var c=o+l;var h=t.schemeCategory10[0],f="#A3A3A3";var d=e.select(u("label-area",true));var v=0;var _=e.selectAll(u("arrow",true)).data(["up","down"]);var p=_.enter().append("g").attr("class",function(t){return u("arrow "+t)}).style("cursor","pointer");p.append("rect").attr("width",c).attr("height",c).attr("fill","#fff").attr("stroke",f).attr("stroke-width","1px").attr("shape-rendering","crispEdges");p.append("path").attr("d",t.symbol().type(t.symbolTriangle).size(o*2.5)).attr("transform",function(t,e){var i="translate("+[(c-1)*.5,(c-1)*.5]+")";return i+(e===1?"rotate(180)":"")}).style("display","block").attr("fill",function(t){return t==="up"?f:h});_=p.merge(_).attr("transform",function(t,e){if(n)return"translate("+[a+l,e*(o+l)]+")";else return"translate("+[0,s+l*1.25+e*(o+l)]+")"});_.on("click",function(t){if(t==="up"&&v>0){v-=1}else if(t==="down"&&v<r){v+=1}else{return}_.select("path").style("fill",h).style("cursor","pointer");if(v===0){_.select("path").filter(function(t){return t==="up"}).style("fill",f).style("cursor","default")}else if(v===r){_.select("path").filter(function(t){return t==="down"}).style("fill",f).style("cursor","default")}d.attr("transform","translate("+[0,-v*(o+l)]+")")})}function te(t,e){var i=e.width();var r=e.isHorizontal()?i/2:i;var n=t.selectAll("defs").data([[{name:Xt,width:i},{name:Yt,width:r}]]);n=n.enter().append("defs").merge(n);var a=n.selectAll("clipPath").data(function(t){return t},function(t){return t.name});a.exit().remove();a=a.enter().append("clipPath").attr("class",function(t){return t.name}).attr("id",function(t){return m(t.name+"-")}).merge(a);var s=a.selectAll("rect").data(function(t){return[t]});s.exit().remove();s=s.enter().append("rect").merge(s).attr("width",function(t){return t.width}).attr("height",e.height());t.select(u("label-area-parent",true)).attr("clip-path","url(#"+a.filter(function(t,e){return e===0}).attr("id")+")");t.selectAll(u("label",true)).attr("clip-path","url(#"+a.filter(function(t,e){return e===1}).attr("id")+")");return t}function ee(e){var i=this.isHorizontal();var r=this.width();var n=i?r/2:r;var a=this.labelHeight();var s=this.labelPadding();var o=0,l=0,c=0;e.call(te,this);e.selectAll(u("label",true)).each(function(e,u){var h=t.select(this);var f=void 0,d=void 0;var v=Math.min(this.getBBox().width,n);if(u===0||i&&l+v+s*2<=r){f=l;d=c}else{o+=1;f=l=0;d=c=c+a+s}l+=v+s*2;h.attr("transform","translate("+[f,d]+")")});if((o+1)*(a+s)>this.height()){e.call($t,this,o)}else{e.selectAll(u("arrow",true)).remove()}}function ie(t){var e=this;this.__execs__.legend=t;var i=t.select(u("label-area",true));if(this.transition()&&!i.empty()){var r=this.transition();t.transition().duration(r.duration).delay(r.delay).attr("transform","translate("+[this.x(),this.y()]+")")}else{t.attr("transform","translate("+[this.x(),this.y()]+")")}if(i.empty()){i=t.append("g").attr("class",u("label-area-parent")).append("g").attr("class",u("label-area"))}var n=this.labelHeight();var a=n/2;var s=this.scale();var o=i.selectAll(u("label",true)).data(s.domain().filter(function(t){return t!==undefined&&t!==null}).map(function(t){return{key:t,color:s(t)}}));o.exit().remove();var l=o.enter().append("g").attr("class",u("label")).style("cursor","pointer");l.append("title");l.append("rect").style("fill","none");l.append("circle");l.append("text").style("letter-spacing","-0.1px");o=l.merge(o).style("fill",function(t){return t.color});o.select("title").text(function(t){return e.format()?e.format()(t.key):t.key});o.select("circle").attr("cx",a).attr("cy",a).attr("r",5);o.select("text").attr("x",n).attr("dx",".35em").attr("dy",".9em").style("fill",this.color()).text(function(t){return e.format()?e.format()(t.key):t.key});o.select("rect").attr("width",function(){return this.parentNode.getBBox().width}).attr("height",function(){return this.parentNode.getBBox().height});var c=this.__execs__.dispatch;o.on("click",function(t){c.call("selectClick",this,t)}).on("mouseenter",function(t){c.call("selectEnter",this,t)}).on("mouseleave",function(t){c.call("selectLeave",this,t)})}function re(t,e){if(typeof e==="function"){return t.filter(e)}else if(typeof e==="string"){return t.filter(function(t){return t.key!==e})}else if(e instanceof Date){var i=e.getTime();return t.filter(function(t){return t.key.getTime()!==i})}else if(e.tagName&&e.tagName==="g"){return t.filter(function(){return this!==e})}return t.filter(function(){return true})}function ne(t){re(this.__execs__.legend.selectAll(u("label",true)),t).transition().duration(Wt).attr("opacity",1)}function ae(t){var e=re(this.__execs__.legend.selectAll(u("label",true)),t);if(e){e.transition().duration(Wt).attr("opacity",this.muteIntensity())}return this}function se(){return this.font()["font-size"]}function oe(){return this.isHorizontal()?this.labelHeight()/2:this.labelHeight()}function le(){}function ce(t){Qt.call(this,t);ie.call(this,t);ee.call(this,t)}qt.prototype.demute=ne;qt.prototype.mute=ae;qt.prototype.labelHeight=se;qt.prototype.labelPadding=oe;qt.prototype.render=ce;qt.prototype.update=le;qt.prototype.isHorizontal=Ut;_(qt,Kt);function ue(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"region";var i=this;var r=this.legend();var n=this.__execs__.canvas;if(!r){n.selectAll(u("legend",true)).remove();return}var a=this.__execs__.field;if(!r.format&&a[e].isInterval())r.format=a[e].format();var s=void 0,o=void 0,l=void 0,c=void 0;var h=this.offset();var f=this.innerSize();var d=this.margin();var v=r.font?r.font["font-size"]:20;if(r.orient==="bottom"||r.orient==="top"){s=0;if(r.orient==="bottom")o=f.height+h.bottom-d.bottom-r.thickness+v;else o=-h.top+d.top-v;if(this.axisX&&!this.axisX()){o+=v*(r.orient==="bottom"?1:-1)}l=f.width;c=r.thickness-v}else{if(r.orient==="right")s=f.width+h.right-r.thickness;else s=-h.left+d.left-v;o=v/2;l=r.thickness-v;c=f.height-v/2}var _=this.scale().color;var p=Zt().scale(_).x(s).y(o).width(l).height(c).orient(r.orient).format(r.format).transition(this.transition());this.__execs__.legend=p;p.on("selectEnter",function(t){if(i.muteFromLegend){i.muteFromLegend(t)}p.mute(this);i.__execs__.selectDispatch.call("legendEnter",this,t)}).on("selectLeave",function(t){if(i.demuteFromLegend){i.demuteFromLegend(t)}p.demute(this);i.__execs__.selectDispatch.call("legendLeave",this,t)});var g=n.selectAll(u("legend",true)).data([p]);g.exit().remove();g.enter().append("g").attr("class",u("legend")).merge(g).each(function(e){e.render(t.select(this))});return this}function he(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:function(t){return t};var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var n=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var a=this.__execs__.canvas.select(u("regions",true)).selectAll(this.regionName()+(r?".facet":"")+n).data(i,function(t,e){return t.data&&t.data.key?t.data.key:e});var s=this.regionName().split(".").join(" ").trim();var o=this.aggregated();var l=s+(r?" facet":"");var c=this.__execs__.canvas;var h=t.transition().duration(this.transition().duration).delay(this.transition().delay);var f=c.selectAll(u("canvas-g-clip-path",true)).attr("id");var d=function e(i){i.each(function(e){if(!o)t.select(this).attr("transform","translate("+[e.x,e.y]+")");else t.select(this).attr("transform","translate(0,0)");if(f&&!r)t.select(this).attr("clip-path","url(#"+f+")")})};var v=function e(i){i.each(function(e){if(!o)t.select(this).transition(h).attr("transform","translate("+[e.x,e.y]+")");else t.select(this).attr("transform","translate(0,0)")})};a.exit().remove();var _=a.enter().append("g").attr("class",l).each(e).call(d);a.each(e);a=_.merge(a);a.call(v);return a}var fe={"font-family":"sans-serif","font-size":11,"font-weight":"normal","font-style":"normal"};var de="legend-gradient-";var ve=["top","bottom"];var _e={color:"#6e6e6e",field:null,height:0,orient:ve[0],gradientWidth:150,gradientHeight:fe["font-size"],scale:null,showTooltip:true,title:null,width:0,x:0,y:0,font:fe};var pe=function t(){i(this,t);this.__attrs__=JSON.parse(JSON.stringify(_e));this.__execs__={spectrum:null,scale:null}};function ge(){return new pe}function me(t){var e=this.font();for(var i in e){t.style(i,i==="font-size"?e[i]+"px":e[i])}}function ye(e,i,r,n){var a=i;var s=i/a;var o=t.scaleLinear().domain([0,i]).range(n);var l=t.range(0,a).map(function(t){return t*s+s});e.selectAll(u("gradient-chip",true)).data(l).enter().append("rect").attr("class",u("gradient-chip")).attr("width",s).attr("height",r).attr("x",function(t){return t-s}).style("fill",function(t){return o(t)})}function xe(e){this.__execs__.spectrum=e.attr("transform","translate("+[this.x(),this.y()]+")");var i=this.scale();var r=i.range();var n=this.gradientWidth();var a=this.gradientHeight();this.__execs__.scale=t.scaleLinear().domain(i.domain()).rangeRound([0,n]);var s=e.select(u("gradient-area",true));if(s.empty()){var o=m(de);var l=t.symbol().type(t.symbolTriangle).size(40);s=e.append("g").attr("class",u("gradient-area"));s.append("path").attr("class",u("arrow")).attr("fill","#777").attr("d",l).style("visibility","hidden");e.append("defs").append("linearGradient").attr("id",o)}s.attr("transform","translate("+[(this.width()-n)/2,18]+")");var h=e.select("linearGradient");var d=h.selectAll("stop").data(r);d.enter().append("stop").merge(d).attr("offset",function(t,e){return e*100+"%"}).attr("stop-color",function(t){return t});if(f()){s.call(ye,n,a,r)}else{var v=s.selectAll(u("gradient-rect",true)).data([i]);v.enter().append("rect").attr("class",u("gradient-rect")).merge(v).attr("width",this.gradientWidth()).attr("height",this.gradientHeight()).attr("fill","url(#"+h.attr("id")+")")}var _=s.selectAll(u("label",true)).data(i.domain());_.enter().append("text").attr("class",u("label")).merge(_).attr("x",function(t,e){return e*n}).attr("y",a).attr("dy","1.25em").attr("text-anchor","middle").style("fill","#999").text(function(t){return c(t)});var p=this.title()||this.field();p=p.localeCompare(B.field)===0?P:p;var g=s.selectAll(".title").data([p]);g.enter().append("text").merge(g).attr("class",u("title")).attr("x",n+this.font()["font-size"]).attr("y",a*.5).attr("dy",".35em").attr("text-anchor","start").text(function(t){return t})}function ke(){this.__execs__.spectrum.select(u("arrow",true)).style("visibility","hidden");return this}function be(){return this.font()["font-size"]}function we(){return this.labelHeight()/2}function ze(t){var e=this.__execs__.scale(t);this.__execs__.spectrum.select(u("arrow",true)).style("visibility","visible").attr("transform","translate("+e+",-5)rotate(180)");return this}function Ae(){}function Ne(t){me.call(this,t);xe.call(this,t)}pe.prototype.hide=ke;pe.prototype.labelHeight=be;pe.prototype.labelPadding=we;pe.prototype.render=Ne;pe.prototype.show=ze;pe.prototype.update=Ae;_(pe,_e);function Fe(){var e=this.legend();if(!e)return;var i=this.__execs__.field;var r=void 0,n=void 0,a=void 0,s=void 0;var o=this.offset();if(e.orient==="bottom"){r=0;n=this.innerSize().height+o.bottom-this.margin().bottom-e.thickness;a=this.innerSize().width;s=e.thickness}var l=this.scale().color;var c=ge().scale(l).field(i.color.field()).x(r).y(n).width(a).height(s);this.__execs__.canvas.selectAll(this.nodeName()+".point").on("mouseenter.spectrum",function(t){c.show(t.value)}).on("mouseleave.spectrum",function(){return c.hide()});this.__execs__.legend=c;var h=this.__execs__.canvas;var f=h.selectAll(u("spectrum",true)).data([c]);f.exit().remove();f.enter().append("g").attr("class",u("spectrum")).merge(f).each(function(e){e.render(t.select(this))});return this}var Te=4;var Oe="#001a32";var Se="#fff";var Me="#7b92ae";var Le=(typeof navigator==="undefined"?"undefined":e(navigator))==="object"?/MSIE 9/i.test(navigator.userAgent):false;var De={"font-family":"sans-serif","font-size":11,"font-weight":"normal","font-style":"normal"};var Ee={absolute:false,anchor:{x:"left",y:"top"},color:null,dx:0,dy:0,font:De,offsetFunc:null,keys:null,keyFunc:null,nodeName:u("mark node",true),target:null,valueFormat:null,valueFunc:null,values:[],x:0,y:0,fromMulti:false,showDiff:false};var Ce=function t(){i(this,t);this.__attrs__=JSON.parse(JSON.stringify(Ee));this.__execs__={tooltip:null,mark:null,init:true};this.valueFormat(c)};function je(){return new Ce}function Re(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1;if(Le)return t.style("filter","alpha(opacity="+e*100+")");else return t.style("opacity",e)}function Pe(){var t=this;var e=this.target();var i=e.__execs__.canvas.selectAll(this.nodeName());i.on("mouseleave.tooltip",function(){if(t.fromMulti())return;t.hide()}).on("mouseenter.tooltip",function(e){Ge.call(t,this,e)})}function Be(){var e=this.target();var i=e.__execs__.canvas.selectAll(this.nodeName());var r=(e.parent()?e.parent():e).__execs__.canvas.node();var n=t.local();var a=this.offsetFunc();var s=this.absolute();var o=0;var l=0;var c=e.offset();o+=c.left;l+=c.top;if(e.parent()){c=e.parent().offset();o+=c.left;l+=c.top}var u=r.parentNode.getBoundingClientRect();var h=r.parentNode.parentNode.getBoundingClientRect();o+=u.left-h.left;l+=u.top-h.top;o+=Te;var f=function t(e,i){if(e.x)i.x+=e.x;if(e.y)i.y+=e.y};var d=function t(e){var i={x:o,y:l};if(a&&typeof a==="function"){var r=a.apply(this,arguments);i.x+=r.x;i.y+=r.y}var n=e;if(s){f(n,i)}else{while(n){f(n,i);n=n.parent}}return i};i.each(function(){var t=d.apply(this,arguments);n.set(this,t)});this.__execs__.mark=n}function Ie(t){var e=this.__execs__.tooltip;if(t.style("position")==="static")t.style("position","relative");if(!e||e.empty()){e=t.append("div").attr("class",u("tooltip")).style("color",Se).style("pointer-events","none").style("background-color",Oe).style("padding","9px").style("border-radius","8px").style("position","absolute").style("z-index","999").call(Re,0);e.append("div").attr("class",u("keys")).style("padding-bottom","1em").style("letter-spacing","0.1px").call(Re,.9);e.append("table").attr("class",u("values")).style("border-collapse","collapse").call(Re,.72);e.append("div").attr("class",u("arrow")).style("position","absolute").style("top","calc("+Te+"px + 50%)").style("left","0%").style("margin",-(Te*2)+"px").style("border-width",Te+"px").style("border-style","solid").style("border-color","transparent "+Oe+" transparent transparent").text(" ")}for(var i in this.font()){e.style(i,this.font()[i]+(i==="font-size"?"px":""))}this.__execs__.tooltip=e;Be.call(this);Pe.call(this)}function He(){var t=this.__execs__.tooltip;t.transition().duration(180).call(Re,0)}function Ve(e){e=t.select(e);Ie.call(this,e)}function Ge(t,e){if(this.fromMulti())return;var i=this.color();var r=this.keyFunc();var n=this.valueFunc();var a=this.__execs__.mark.get(t);this.x(a.x).y(a.y).color(i?i:e.color).key(r?r.call(this,e,e.key):null).value(n.call(this,e,e.text)).show();return this}function Xe(){var t=this.valueFormat();var e=this.__execs__.tooltip;if(this.keys()){var i=e.select(u("keys",true)).selectAll(u("key",true)).data(this.keys());i.exit().remove();i=i.enter().append("div").attr("class",u("key")).merge(i);i.text(function(t){return t.value})}var r=e.select(u("values",true)).selectAll(u("value",true)).data(this.values());r.exit().remove();r=r.enter().append("tr").attr("class",u("value")).merge(r);if(this.showDiff()&&r.size()>1){r.style("color",function(t,e){return e===0?Me:Se})}else{r.style("color",Se)}var n=r.selectAll("td").data(function(t){return[t.name,t.value]});n.exit().remove();n=n.enter().append("td").style("padding",0).style("margin",0).style("padding-bottom",".35em").style("padding-right",function(t,e){return e===0?"2em":0}).style("text-align",function(t,e){return e===0?"left":"right"}).merge(n).text(function(e,i){if(i===0){return e.localeCompare(B.field)===0?P:e}else{return t(e)}});var a=e.node().getBoundingClientRect().height/2;e.style("left",this.x()+this.dx()+"px").style("top",this.y()+this.dy()-a+"px").transition().duration(180).call(Re,1)}function Ye(t){if(!arguments.length||t===null)return this;if("name"in t&&"value"in t)this.__attrs__.keys=[t];return this}function Je(t){if(!arguments.length)return this;if(Array.isArray(t)){this.__attrs__.values=t}else if("name"in t&&"value"in t){this.__attrs__.values=[t]}return this}Ce.prototype.hide=He;Ce.prototype.render=Ve;Ce.prototype.show=Xe;Ce.prototype.showFromPoint=Ge;Ce.prototype.key=Ye;Ce.prototype.value=Je;_(Ce,Ee);function We(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var r=je().dx(t&&t.dx?t.dx:0).dy(t&&t.dy?t.dy:0).target(this).absolute(i).fromMulti(e);var n=(this.parent()?this.parent():this).__execs__.canvas;if(t.color)r.color(t.color);if(!e){r.keyFunc(t.key).valueFunc(t.value).offsetFunc(t.offset).showDiff(t.showDiff);this.__execs__.tooltip=r}r.render(n.node().parentNode.parentNode);return r}function Ke(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.__execs__.axis={};this.__execs__.legend=null;if(!this.parent())this.__execs__.mark=t.local();this.__execs__.field={};this.__execs__.regions=null;this.__execs__.nodes=null;if(!e)this.__execs__.scale={};if(!this.parent()&&this.__execs__.canvas)t.select(this.container()).selectAll(u("tooltip",true)).remove();return this}function qe(t){if(!arguments.length)return this.__attrs__.size;if(Array.isArray(t)){this.__attrs__.size={range:t,reverse:false}}else if(typeof t==="number"){this.__attrs__.size={range:[t,t],reverse:false}}else if((typeof t==="undefined"?"undefined":e(t))==="object"){this.__attrs__.size=t}return this}function Ze(t){if(!arguments.length)return this.__execs__.scale;return this.__execs__.scale[t]}function Ue(t){v(this,t);return this}function Qe(t,e,i){var r=[];if(i[0]>e[0])r[0]=e[0];else r[0]=i[0];if(i[1]<e[1])r[1]=e[1];else r[1]=i[1];t.domain(r);if(e[0]===r[0]&&e[1]===r[1])t.nice()}function $e(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var r=i?t:this.__execs__.scale[t];var n=i?null:this.__execs__.field[t];r._defaultDomain=e;if(i){r.domain(e).nice()}else if(this.customDomain()){Qe(r,e,this.customDomain())}else if((this.isMixed?!this.isMixed():true)&&n.customDomain()){Qe(r,e,n.customDomain())}else{r.domain(e).nice()}return this}function ti(){for(var t=arguments.length,e=Array(t),i=0;i<t;i++){e[i]=arguments[i]}if(this.multiTooltip&&this.multiTooltip())return;var r=function t(i){var r=true;var n=i;e.forEach(function(t){r=r&&n.data.key===t;if(n.parent)n=n.parent;else return r});return r};var n=this.filterNodes(r);var a=this.__execs__.tooltip;if(n.size()>0){n.each(function(t){a.showFromPoint(this,t)})}return this}function ei(e,i){i=i||this.font();for(var r in i){if(!e.selectAll)e=t.select(e);e.style(r,i[r]+(r==="font-size"?"px":""))}}function ii(t){if(!arguments.length)return this.__attrs__.tooltip;if(typeof t==="boolean"){if(t){t={sortByValue:"natural"}}}if((typeof t==="undefined"?"undefined":e(t))==="object"){if(!t.sortByValue)t.sortByValue="natural"}this.__attrs__.tooltip=t;return this}function ri(t,i){var r=0;t=t.map(function(n){if(n===undefined){var a=function e(){var n=i[r];r+=1;if(t.findIndex(function(t){return t==n})<0){return{v:n}}};while(r<i.length){var s=a();if((typeof s==="undefined"?"undefined":e(s))==="object")return s.v}}return n});return t.filter(function(t){return t!==undefined})}function ni(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var r=this.scale().color;if(this.colorDomain()&&this.colorDomain().length>0){var n=this.colorDomain();var a=this.color();var s=e.map(function(t){var e=n.findIndex(function(e){return t==e.key});if(e>=0){return n[e].color?n[e].color:a[e]}else{return undefined}});s=ri(s,a);var o=t.scaleOrdinal().domain(e).range(s);o._defaultRange=this.color();return o}else if(i&&r&&r.unknown&&this.color()===r._defaultRange){var l=this.color();var c=this.scale().color.domain();var u=this.scale().color.range();var h=false;var f=e.map(function(t){var e=c.findIndex(function(e){return e===t});if(!h&&e>=0)h=true;return e});if(h){var d=f.map(function(t){if(t>=0&&t<u.length){return u[t]}else{return undefined}});d=ri(d,l);return r.domain(e).range(d)}}var v=t.scaleOrdinal().domain(e).range(this.color());v._defaultRange=this.color();return v}var ai={"font-family":"sans-serif","font-size":12,"font-weight":"lighter","font-style":"normal"};var si=["#ece7f2","#50C3F7"];var oi=l;var li={aggregated:false,color:oi,colorDomain:null,container:null,customDomain:null,data:[],dimensions:[],font:ai,height:480,label:null,legend:null,limitKeys:200,limitRows:1e3,name:null,nodeName:u("mark node",true),margin:{top:40,right:40,bottom:40,left:40},measures:[],muteIntensity:.3,parent:null,regionName:u("mark region",true),size:null,tooltip:true,transition:{duration:600,delay:20},width:640,zeroOffset:false,zeroMargin:false};var ci=function e(){i(this,e);this.setAttrs(li);this.__execs__={axis:{},condition:null,canvas:null,hidden:null,field:{},legend:null,mark:t.local(),scale:{},tooltip:null,regions:null,nodes:null};this.on=undefined;this.__execs__.selectDispatch=t.dispatch("selectClick","selectEnter","selectLeave","legendEnter","legendLeave");this.rebindOnMethod(this.__execs__.selectDispatch)};ci.prototype.font=p("font",ai);ci.prototype.transition=p("transition",li.transition);ci.prototype.aggregated=d("aggregated");ci.prototype.container=d("container");ci.prototype.customDomain=d("customDomain");ci.prototype.data=d("data");ci.prototype.height=d("height");ci.prototype.label=d("label");ci.prototype.name=d("name");ci.prototype.muteIntensity=d("muteIntensity");ci.prototype.regionName=d("regionName");ci.prototype.width=d("width");ci.prototype.zeroOffset=d("zeroOffset");ci.prototype.zeroMargin=d("zeroMargin");ci.prototype.aggregate=C;ci.prototype.aggregateMixed=X;ci.prototype.color=Y;ci.prototype.colorDomain=J;ci.prototype.condition=W;ci.prototype.demute=Z;ci.prototype.demuteLegend=U;ci.prototype.demuteNodes=$;ci.prototype.demuteRegions=et;ci.prototype.dimension=nt;ci.prototype.dimensions=at;ci.prototype.domain=st;ci.prototype.filterNodes=ot;ci.prototype.filterRegions=lt;ci.prototype.hideTooltip=ct;ci.prototype.innerSize=ut;ci.prototype.legend=dt;ci.prototype.limitKeys=vt;ci.prototype.limitRows=_t;ci.prototype.margin=gt;ci.prototype.mixedDimension=kt;ci.prototype.measure=mt;ci.prototype.measureName=yt;ci.prototype.measures=xt;ci.prototype.mute=q;ci.prototype.muteLegend=bt;ci.prototype.muteNodes=wt;ci.prototype.muteRegions=At;ci.prototype.nodeName=Nt;ci.prototype.nodes=Ft;ci.prototype.offset=Ot;ci.prototype.parent=St;ci.prototype.tooltip=ii;ci.prototype.scale=Ze;ci.prototype.styleFont=ei;ci.prototype.rebindOnMethod=Mt;ci.prototype.regions=Lt;ci.prototype.remove=Dt;ci.prototype.render=Ct;ci.prototype.renderCanvas=Bt;ci.prototype.renderFrame=Vt;ci.prototype.renderLegend=ue;ci.prototype.renderRegion=he;ci.prototype.renderSpectrum=Fe;ci.prototype.renderTooltip=We;ci.prototype.reset=Ke;ci.prototype.size=qe;ci.prototype.setAttrs=Ue;ci.prototype.setCustomDomain=$e;ci.prototype.showTooltip=ti;ci.prototype.updateColorScale=ni;var ui=14;var hi=18;var fi=18;var di=c;var vi=["x","y"];var _i=["top","right","bottom","left"];var pi=t.format(".2s");var gi=t.format(",");var mi={"font-family":"sans-serif","font-size":10,"font-weight":"normal","font-style":"normal","letter-spacing":"0.1px"};var yi=13;var xi="#c0ccda";var ki="#485465";var bi="#e7ebef";var wi="#aaa";var zi=45;var Ai=300;var Ni={autoTickFormat:true,autoRotate:true,color:"#7b92ae",field:null,facet:null,font:mi,format:null,grid:false,gridSize:0,interval:null,orient:_i[2],scale:null,showTitle:true,showDomain:true,showTicks:true,thickness:40,target:vi[0],tickFormat:null,title:"",titleOrient:null,ticks:null,tickRotate:0,tickSize:0,tickPadding:4,transition:null,x:0,y:0};var Fi=function t(){i(this,t);this.__attrs__=JSON.parse(JSON.stringify(Ni));this.__execs__={axis:null,canvas:null,rotated:false}};function Ti(){return new Fi}function Oi(){return this.orient()==="bottom"||this.orient()==="top"}function Si(){var e=this.orient();var i=this.scale();var r=void 0;if(e===_i[0])r=t.axisTop();else if(e===_i[1])r=t.axisRight();else if(e===_i[3])r=t.axisLeft();else r=t.axisBottom();this.__execs__.axis=r;if(i)r.scale(i);if(this.transition()){var n=this.transition();this.__execs__.transition=t.transition().duration(n.duration).delay(n.delay)}}function Mi(t,e){if(this.grid()&&this.gridSize()>0){var i=this.__execs__.axis;var r=this.gridSize();var n=this.isHorizontal();var a=this.orient();var s=n?"y2":"x2";var o=a==="left"||a==="top"?1:-1;var l=this.scale();var c=t.selectAll(".grid").data(l.ticks(i._tickNumber).map(function(t){return l(t)}));c.exit().remove();var u=c.enter().append("g").attr("class","grid");u.append("line").style("stroke",bi);c=u.merge(c);if(this.transition()&&!e){c=c.transition(this.__execs__.transition)}c.attr("transform",function(t){return"translate("+(n?[t+.5,0]:[0,t-.5])+")"}).select("line").attr(s,o*r)}else{t.selectAll(".grid").remove()}}function Li(e){var i=this;var r=this.scale();var n=this.orient();var a=function(){if(r.bandwidth){var t=r.bandwidth();if(t===0)return r.step();return r.bandwidth()}else{var e=r.ticks();if(e.length>1){return Math.abs(r(e[1])-r(e[0]))}else{return Math.abs(r.range[r.range().length-1]-r.range()[0])}}}();var s=function t(){var e="axis-"+i.target()+"-"+i.orient()+"-";return m(e)};var o=function i(){e.selectAll(".tick").each(function(){var e=t.select(this);var i=e.select("title");if(i.empty())i=e.insert("title",":first-child");var r=e.select("text").text();i.text(r)})};var l=function t(){var a=e.select("defs");if(a.empty()){var o=s();a=e.append("defs");a.append("clipPath").attr("id",o).append("rect");e.selectAll(".tick").attr("clip-path","url(#"+o+")")}var l={};var c=Math.abs(r.range()[1]-r.range()[0]);if(c===0)c=r.range()[0]*2;if(i.isHorizontal()){l.width=c;l.height=i.thickness()-(i.showTitle()?i.font()["font-size"]*1.71:0);l.x=-l.width/2;l.y=n==="bottom"?0:-l.height}else{l.width=i.thickness();l.height=c;l.x=n==="left"?-l.width:0;l.y=-l.height/2}a.select("clipPath").select("rect").datum(l).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.width}).attr("height",function(t){return t.height})};var c=function t(){var n=i.showTicks();var s=a<i.font()["font-size"]*(i.isHorizontal()?1:.72);e.selectAll(".tick").style("visibility",s&&r.bandwidth?"hidden":n?"inherit":"hidden")};var h=function n(){var a=i.tickPadding();var s=i.tickRotate();var o=i.isHorizontal();var l=i.orient()==="right"||i.orient()==="top";var c=function t(e){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:s;var n=void 0;if(o)n=[0,a/2];else n=[e.attr("x")*.71,0];if(i.transition())e=e.transition().duration(180);e.attr("transform","translate("+n+") rotate("+r*-1+")").attr("text-anchor",o?"start":"end").attr("text-anchor",l?"start":"end")};if(s!==0){e.selectAll(".tick > text").call(c);i.__execs__.rotate=true;return}else if(i.autoRotate()){var h=e.selectAll(".tick");var f=0;h.each(function(){var e=this.getBBox().width;if(t.select(this).selectAll("text").classed(u("rotated")))e*=1.25;f+=e});var d=f>=Math.abs(r.range()[1]-r.range()[0]);if(o){if(d){h.selectAll("text").classed(u("rotated"),true).call(c,zi)}else{var v=h.selectAll("text"+u("rotated",true)).classed(u("rotated"),false);if(i.transition())v=v.transition().duration(180);v.attr("transform","").attr("text-anchor","middle")}}}};o();l();h();c()}function Di(t){if(typeof t[0]==="number"&&t[1]>=1e5&&Math.abs(t[1]-t[0])>=1e3)return pi;else return gi}function Ei(){var e=this.__execs__.axis;var i=this.tickFormat();var r=this.scale();if(i){if(typeof i==="function")e.tickFormat(function(t){if(typeof t==="string"&&isNaN(t))return t;return i(t)});else if(r._scaleType==="time")e.tickFormat(t.timeFormat(i));else e.tickFormat(t.format(i))}else if(this.autoTickFormat()){if(r.invert&&r.domain()[0]instanceof Date){return}var n=r.domain();if(r.invert&&!r.padding){e.tickFormat(Di(n))}else{e.tickFormat(function(t){return c(t)})}}}function Ci(t,e){var i=t.range();e=e||Math.abs(i[1]-i[0]);var r=t.ticks().length;if(e<=Ai/2){r=2}else if(e<=Ai){r=5}else{r=Math.round(r/2)}return r}function ji(e){var i=this.__execs__.axis;var r=this.font();var n=this.scale();i.tickSize(this.tickSize()).tickPadding(this.tickPadding()+(this.isHorizontal()?4:2));if(this.ticks()){i.ticks(this.ticks());i._tickNumber=this.ticks()}else if(n.invert){if(n._scaleType==="time"){var a=w[this.interval()];if(a&&!this.autoTickFormat()&&this.tickFormat()){i.ticks(a);i._tickNumber=n.ticks(a).length}else{var s=this.tickFormat();if(s){i._tickNumber=t.set(n.ticks().map(s)).values().length;i.ticks(i._tickNumber)}else{i._tickNumber=n.ticks().length}}}else{var o=Ci(n);i.ticks(o);i._tickNumber=o}}else{i._tickNumber=n.domain().length}for(var l in r){e.style(l,l==="font-size"?r[l]+"px":r[l])}}function Ri(t,e){var i=this;var r=this.__execs__.axis;if(t.selectAll(".domain").size()===0){t.attr("transform","translate("+[this.x(),this.y()]+")")}if(this.transition()&&!e){t.transition(this.__execs__.transition).attr("transform","translate("+[this.x(),this.y()]+")").call(r).on("end",function(){Li.call(i,t)})}else{t.attr("transform","translate("+[this.x(),this.y()]+")").call(r);Li.call(this,t)}}function Pi(t){var e=t.selectAll(".tick");e.select("line").style("stroke",this.color());e.select("text").style("fill",this.color());t.select(".domain").style("stroke",xi).style("shape-rendering","crispEdges").style("stroke-width","1px").style("visibility",this.showDomain()?"visible":"hidden")}function Bi(e){var i=this;var r=function t(e){if(i.isHorizontal()){e.attr("dy",s==="bottom"?"-1em":".71em")}else{if(o==="bottom"||o==="top"){e.attr("dy",o==="bottom"?"2em":"-1em")}}};var n=function e(r){if(i.isHorizontal()){var n=0;r.attr("transform","translate("+[c,s==="bottom"?i.thickness()-n:-i.thickness()+n]+")")}else{if(o==="bottom"||o==="top"){r.attr("transform","translate("+[0,o==="bottom"?t.max(l.range()):t.min(l.range())]+")")}else{r.attr("transform","translate("+[i.thickness()*(s==="left"?-1:1),c]+") "+(s==="left"?"rotate(90)":"rotate(-90)"))}}};var a=this.title()||this.field();if(!a)return;a=a.localeCompare(B.field)===0?P:a;if(!this.showTitle()){e.selectAll(".title").remove();return}var s=this.orient();var o=this.titleOrient()||s;var l=this.scale();var c=(l.range()[0]+l.range()[1])/2;var u=e.selectAll(".title").data([a]);u.exit().remove();var h=u.enter().append("g").attr("class","title").call(n);h.append("text").attr("text-anchor","middle").style("font-size",yi+"px").style("fill",ki).call(r);u=h.merge(u);u.select("text").text(a);if(this.transition()){u.transition(this.__execs__.transition).call(n)}}function Ii(t,e){var i=this.scale();if(i.invert&&y(i.domain())){var r=this.gridSize();var n=this.isHorizontal();var a=this.orient();var s=n?"y2":"x2";var o=a==="left"||a==="top"?1:-1;var l=this.scale();var c=[];t.selectAll(".tick").filter(function(t){return t===0}).each(function(t){c.push(l(t))});var u=t.selectAll(".zero.grid").data(c);u.exit().remove();var h=u.enter().append("g").attr("class","grid zero");h.append("line").style("stroke",wi);u=h.merge(u);if(this.transition()&&!e){u=u.transition(this.__execs__.transition)}u.attr("transform",function(t){return"translate("+(n?[t+.5,0]:[0,t-.5])+")"}).select("line").attr(s,o*r)}}function Hi(t){if(!arguments.length)return this.__attrs__.facet;if(_i.includes(t))this.__attrs__.facet={orient:t};else this.__attrs__.facet={orient:_i[0]};return this}function Vi(){}function Gi(t){var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(t){this.__execs__.canvas=t}else if(this.__execs__.canvas){t=this.__execs__.canvas}else{return}Si.call(this);Ei.call(this);ji.call(this,t);Ri.call(this,t,e);Pi.call(this,t);Mi.call(this,t,e);Ii.call(this,t,e);Bi.call(this,t)}Fi.prototype.facet=Hi;Fi.prototype.render=Gi;Fi.prototype.update=Vi;Fi.prototype.isHorizontal=Oi;_(Fi,Ni);function Xi(t){var e=Object.assign({},t);if(e.orient&&e.orient==="x"){e.target=e.orient;e.orient="bottom"}else if(e.orient&&e.orient==="y"){e.target=e.orient;e.orient="left"}var i=e.target==="x";if(!("showDomain"in e))e.showDomain=true;if(!("showTicks"in e))e.showTicks=true;if(!("showTitle"in e))e.showTitle=true;if(!("orient"in e))e.orient=i?"bottom":"left";if(!("thickness"in e)){e.thickness=i?fi:hi;e.thickness+=e.tickPadding?e.tickPadding:0;e.thickness+=e.showTitle?ui*2:0;e.thickness+=e.showTicks?ui:0;e.defaultThickness=e.thickness}return e}function Yi(t){var i=this;var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var n=void 0;if(!arguments.length)return this.__attrs__.axis;if(Array.isArray(t)){this.__attrs__.axis=t.map(Xi);t.forEach(function(t){return i.__execs__.axis[t.target]={}});return this}else if(typeof t==="string"){n={target:t};n=Xi(n)}else if((typeof t==="undefined"?"undefined":e(t))==="object"){n=Object.assign({},t);n=Xi(n)}var a=this.__attrs__.axis.findIndex(function(t){return t.target===n.target&&t.orient===n.orient});if(r){if(a>=0){this.__attrs__.axis.splice(a,1,n)}else{this.__attrs__.axis.push(n)}if(!this.__execs__.axis[n.target])this.__execs__.axis[n.target]={}}else{if(a>=0){this.__attrs__.axis.splice(a,1)}}return this}function Ji(t,e,i){if(!arguments.length)return this.__execs__.axis;this.__execs__.axis[t]=this.__execs__.axis[t]||{};this.__execs__.axis[t][e]=i;return this}function Wi(t,e,i){if(t[i]!==undefined)e[i](t[i])}function Ki(t,e){var i=this.axisTitles().filter(function(t){return t.target===e.target&&(!t.field||t.field===e.field)&&(!t.shape||t.shape===e.shape)});if(i.length>0)i=i[0];else i=null;var r=Ti();r.scale(t).target(e.target).field(e.field).orient(e.orient).tickFormat(e.tickFormat).title(i?i.title:e.title).titleOrient(e.titleOrient).autoTickFormat(e.autoTickFormat).transition(this.transition());if(t._field){var n=t._field;if(n.interval&&n.interval())r.interval(n.interval());if(n.format&&n.format()&&!e.autoTickFormat)r.tickFormat(n.format());else if(e.autoTickFormat)r.tickFormat(null)}else r.interval(null);["tickPadding","thickness","showTitle","showDomain","showTicks"].forEach(function(t){return Wi(e,r,t)});Ji.call(this,e.target,e.field,r);return r}function qi(){return this.axis().find(function(t){return t.target==="x"})}function Zi(){return this.axis().find(function(t){return t.target==="y"})}function Ui(t,i){var r=void 0;if(typeof t==="string"){var n=t.split(".");r={target:n[0],field:n.length>=2?n.slice(1).join("."):null}}else if((typeof t==="undefined"?"undefined":e(t))==="object"){r=t}else{throw new Error(".axisTitle: "+t+" is not unavailable")}var a=this.axisTitles();var s=-1;for(var o=0;o<a.length;o++){var l=a[o];if(l.field===r.field&&l.target===r.target){s=o;break}}if(i){var c=Object.assign({},r);c.title=i;if(s>=0)a.splice(s,1,c);else a.push(c)}else{a.splice(s,1)}return this}function Qi(){var e=this;var i=this.__execs__.canvas;var r=this.__execs__.axis;var n=function t(e,i,r){var n="axis target-"+i.target()+" orient-"+i.orient()+" targetNum-"+r;var a=e.selectAll(u(n,true)).data([r]);a.exit().remove();a=a.enter().insert("g",":first-child").attr("class",u(n)).merge(a).classed(u("active"),true);i.render(a)};var a=i.selectAll(u("axis",true));a.classed(u("active"),false);for(var s in r){if(r.hasOwnProperty(s)){(function(){var t=0;for(var a in r[s]){if(r[s].hasOwnProperty(a)){var o=r[s][a];if(o.facet()){i.selectAll(e.regionName()).call(n,o,t)}else{i.call(n,o,t)}}t+=1}i.selectAll(u("axis target-"+s,true)).filter(function(e){return e>=t}).remove()})()}}a.filter(function(){return!t.select(this).classed(u("active"))}).remove();return this}function $i(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var n=this.__execs__.hidden;if(!(t&&t.showTicks)||t&&t.autoTickFormat)return;var a=t.font||mi;var s=t.tickFormat||(r?di:Di(e.domain()));var o=r?e.domain():e.ticks();if(e._field){var l=e._field;if(l.format()&&!t.autoTickFormat)s=l.format();if(l.interval&&l.interval())o=e.ticks(w[e._field.interval()])}var c=-1;var h=false;var f=this.innerSize();var d=i?f.width/o.length*.9:0;var v=n.selectAll(u("tick",true)).data(s?o.map(s):o);v=v.enter().append("text").attr("class",u("tick")).merge(v).text(function(t){return t});this.styleFont(v,a);v.each(function(){var t=this.getBBox().width;if(t>c)c=t;if(t>d)h=true});c=c*(i?.8:1)+ui*(i?1.5:1);if(t.tickPadding)c+=t.tickPadding;if(t.showTitle)c+=ui;if(t.thickness)c+=ui;if(t.defaultThickness){if(h&&c>t.defaultThickness){t.thickness=c}else if(t.defaultThickness<t.thickness){t.thickness=t.defaultThickness}}if(t.target==="x"){t.thickness=Math.min(t.thickness,this.height()*.5)}else{t.thickness=Math.min(t.thickness,this.width()*.8)}v.remove();t.thickness=Math.round(t.thickness);return t.thickness}var tr={axis:[],axisTitles:[],grid:false,noAxisOffset:false};var er=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(tr);return t}r(e,[{key:"offset",value:function t(){var t=n(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"offset",this).call(this);t=Object.assign({},t);var i=this.axis();if(!this.noAxisOffset()){i.forEach(function(e){t[e.orient]+=e.thickness})}return t}}]);return e}(ci);er.prototype.axisTitles=d("axisTitles");er.prototype.axisToggle=d("axisToggle");er.prototype.grid=d("grid");er.prototype.noAxisOffset=d("noAxisOffset");er.prototype.axis=Yi;er.prototype.axisX=qi;er.prototype.axisY=Zi;er.prototype.axisDefault=Ki;er.prototype.axisTitle=Ui;er.prototype.renderAxis=Qi;er.prototype.thickness=$i;function ir(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var e=this.facet();var i=this.__execs__.field;var r=this.axisX();var n=this.axisY();var a=this.__execs__.scale;var s=this.innerSize();if(e.orient==="horizontal"&&r){i[t?"region":"x"].axis(r);r.orient="top";r.showDomain=false;this.axisDefault(a.region,r)}else if(e.orient==="vertical"&&n){i[t?"region":"x"].axis(n);n.orient="right";n.showDomain=false;this.axisDefault(a.region,n).x(s.width)}return this}var rr=["vertical","horizontal"];function nr(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(!arguments.length)return this.__attrs__.facet;if(!t)this.__attrs__.facet=false;else if(rr.includes(t))this.__attrs__.facet={orient:t};else this.__attrs__.facet={orient:rr[0]};return this}var ar={facet:false};var sr=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(ar);return t}return e}(er);sr.prototype.axisFacet=ir;sr.prototype.facet=nr;var or={padding:0,regionPadding:0};var lr=function t(e){var r=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(or);return t}return e}(e);r.prototype.padding=d("padding");r.prototype.regionPadding=d("regionPadding");_(r,or);return r};function cr(t){if(!arguments.length)return this.__attrs__.sortByValue;if(t&&(typeof t!=="string"||!ur.find(function(e){return e===t}))){t="natural"}this.__attrs__.sortByValue=t;return this}var ur=["natural","ascending","descending"];var hr={sortByValue:ur[0]};var fr=function t(e){var r=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(hr);return t}return e}(e);r.prototype.sortByValue=cr;return r};var dr={stacked:false,normalized:false};var vr=function t(e){var r=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(dr);return t}return e}(e);r.prototype.stacked=d("stacked");r.prototype.normalized=d("normalized");return r};var _r={interval:null,max:100,order:"natural"};var pr=function(e){a(o,e);function o(t){i(this,o);var e=s(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));v(e,_r);e.setInit(t,["interval","max","order"]);return e}r(o,[{key:"domain",value:function e(){var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var r=arguments[1];var n=this.munged();var a=this.level();var s=this.order();var e=[];var o=0;function l(e,i){if(i===a){return e.map(r?r:function(t){return{key:t.data.key,value:t.value}})}else{return t.merge(e.map(function(t){return l(t.children,i+1)}))}}e=l(n,o);var c=[];e.forEach(function(t){if(c.findIndex(function(e){return e===t})<0){c.push(t)}});e=c;if((!i||i==="natural")&&s&&s!=="natural")e.sort(O(s,[],true,function(t){return t.key}));if(i&&i!=="natural")e.sort(O(i,[],true,function(t){return t.value}));return e.map(function(t){return t.key})}},{key:"isInterval",value:function t(){return this.interval()&&this.format()}},{key:"toObject",value:function t(){var e=n(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"toObject",this).call(this);e.interval=this.interval();e.max=this.max();e.order=this.order();return e}}]);return o}(R);function gr(t){return new pr(t)}_(pr,_r);function mr(t,e){var i=this.__execs__.field;if(t.length<=2&&e.length<=1){if(t.length===2){i.region=gr(t[0]);i.x=gr(t[1])}else{i.x=gr(t[0])}if(e.length===0){this.measure(B)}i.y=G(e[0]);return Mr[e.length===0?1:0]}else if(t.length<=1&&e.length>=2){if(t.length===1){i.region=gr(t[0])}i.x=gr(this.mixedDimension());i.y=G(I).mixed(true).measures(e);return Mr[2]}else throw new A}function yr(){var t=this;this.condition(mr);var e=this.__execs__.field;var i=this.isMixed();if(this.aggregated()){this.__execs__.munged=[this.data()]}else{if(i){this.__execs__.munged=this.aggregateMixed(this.facet()&&!this.stacked())}else{this.__execs__.munged=this.aggregate(this.facet()&&!this.stacked())}if(!this.isNested())this.__execs__.munged=[this.__execs__.munged[0].parent]}if(this.stacked()){if(!e.region){M(this.__execs__.munged,e.y,this.normalized())}else{var r=void 0;this.__execs__.munged.forEach(function(i,n){if(e.x.order()==="natural"){if(n===0)r=i.children.map(function(t){return t.data.key});else i.children.sort(O("ascending",r,true,function(t){return t.data.key}))}M(i.children,e.y,t.normalized())})}}}function xr(e){var i=this.scale();var r=this.__execs__.munged;var n=this.isNested();var a=this.stacked();var s=this.facet();var o=this.aggregated();var l=this.__execs__.field;var c=this.axisX();var u=this.axisY();var h=void 0,f=void 0;var d=void 0;i.x=t.scaleBand().padding(this.padding());i.y=t.scaleLinear();if(n){d=l.region.level(0).munged(r).domain();i.region=t.scaleBand().domain(d).padding(this.regionPadding())}if(this.isFacet()){i.region=t.scaleBand().domain(d).padding(this.regionPadding());i.color=this.updateColorScale(d,e);if(s.orient==="horizontal"&&c){c.orient="top";c.showDomain=false;this.thickness(c,i.region,true,true);if(u)u.thickness=0}else if(s.orient==="vertical"&&u){u.orient="right";u.showDomain=false;this.thickness(u,i.region,false,true);if(c)c.thickness=0}var v=this.innerSize();if(s.orient==="vertical"){i.region.rangeRound([0,v.height])}else{i.region.rangeRound([0,v.width])}return}var _=1;f=l.x.level(_).munged(r).domain(this.sortByValue());h=l.y.level(_).munged(r).aggregated(o).domain(0,a);if(n||!n&&(this.mono()===false||a)){i.color=this.updateColorScale(f,e)}if(h[0]>0)h[0]=0;else if(h[1]<0)h[1]=0;if(this.showDiff()&&!n){if(h[0]===0)h[1]*=1.25;else if(h[1]===0)h[0]*=1.25}if(a){if(!n){i.x.domain([l.x.field()])}}else{i.x.domain(f)}this.setCustomDomain("y",h);var p=n?l.region:l.x;if(this.isVertical()){p.axis(c);this.thickness(u,i.y,false,false);this.thickness(c,n?i.region:i.x,true,true)}else{p.axis(u);this.thickness(u,n?i.region:i.x,false,true);this.thickness(c,i.y,true,false)}var g=this.innerSize();if(this.isVertical()){if(n){i.region.range([0,g.width]);i.x.range([0,i.region.bandwidth()])}else{i.x.range([0,g.width])}i.y.range([g.height,0])}else{if(n){i.region.range([0,g.height]);i.x.range([0,i.region.bandwidth()])}else{i.x.range([0,g.height])}i.y.range([0,g.width])}}function kr(){var e=this;var i=this.__execs__.canvas;var r=this.isNested.call(this);var n=this.__execs__.scale;var a=this.stacked();var s=this.isVertical();var o=this.color();var l=t.transition().duration(this.transition().duration).delay(this.transition().delay);var h=this.measureName();var f=y(n.y.domain());var d=this.label();var v=this.__execs__.field;var _=this.showDiff();var p=!r&&_;var g=function e(i){var l=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var u=function t(e){if(l)return o[0];else return n.color(e.data.key)};var d=function e(i){var r=v.x.interval()&&v.x.format()?t.timeFormat(v.x.format()):null;return r?r(i):i};i.each(function(t){var e=void 0,i=void 0,o=void 0,l=void 0;var v=t.value;var _=v>=0;if(a){e=0;i=(s?_:!_)?n.y(t.data.value[h+"-end"]):n.y(t.data.value[h+"-start"]);o=r?n.region.bandwidth():n.x.width;l=Math.abs(n.y(t.data.value[h+"-start"])-n.y(t.data.value[h+"-end"]))}else{e=n.x(t.data.key);i=(s?_:!_)?n.y(v):f?n.y(0):n.y.range()[0];o=n.x.bandwidth();l=Math.abs((f?n.y(0):n.y.range()[0])-n.y(v))}var p=s?{x:e,y:i+(_?0:.5),w:o,h:l,upward:_}:{x:i+(_?.5:0),y:e,w:l,h:o,upward:_};p.key=d(t.data.key);p.color=u(t);p.text=c(v);for(var g in p){if(p.hasOwnProperty(g))t[g]=p[g]}})};var m=function e(i){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;i.each(function(e){var i=t.select(this);i.style("cursor","pointer").style("fill",function(e){if(t.select(this).classed(u("diff")))return"none";else return e.color});if(r){i.attr("x",e.x).attr("y",e.upward?e.y+e.h:e.y).attr("width",e.w).attr("height",0)}else{i.attr("x",e.upward?e.x:e.x+e.w).attr("y",e.y).attr("width",0).attr("height",e.h)}})};var x=function i(r){var n=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;r.each(function(i){var r=t.select(this);r.style("pointer-events","none").text(i.text);if(n){r.attr("x",i.x+i.w/2).style("text-anchor","middle");if(a)r.attr("y",i.y+i.h).attr("dy","1em");else if(i.upward)r.attr("y",i.y+i.h).attr("dy","-.25em");else r.attr("y",i.y).attr("dy","1em")}else{r.attr("y",i.y+i.h/2).attr("dy",".35em");if(a)r.attr("x",i.x+i.w/2).attr("text-anchor","middle");else if(i.upward)r.attr("x",i.x).attr("dx",".5em");else r.attr("x",i.x+i.w).attr("text-anchor","end").attr("dx","-.1em")}e.styleFont(r)})};var k=function e(i){i.transition(l).attr("x",function(t){return t.x}).attr("y",function(t){return t.y}).attr("width",function(t){return t.w}).attr("height",function(t){return t.h}).style("fill",function(e){if(t.select(this).classed(u("diff")))return"none";else return e.color})};var b=function e(i){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;i.each(function(e){var i=t.select(this);if(r){i.transition(l).attr("y",e.upward?e.y:e.y+e.h)}else{if(a)i.transition(l).attr("x",e.x+e.w/2).attr("text-anchor","middle");else i.transition(l).attr("x",e.upward?e.x+e.w:e.x)}i.text(e.text).style("fill",a?"#fff":e.color).style("visibility",d&&(!_||_&&i.classed(u("diff")))?"visible":"hidden")})};var w=void 0;var z=i.selectAll(this.regionName());w=z.selectAll(this.nodeName()).data(function(t){var e=t.children;return a?e.slice().reverse():e},function(t){return t.data.key});w.exit().remove();var A=w.enter().append("g").attr("class",this.nodeName(true)).call(g,r?false:this.mono());A.append("rect").attr("class",u("bar")).call(m,s);A.append("text").attr("class",u("bar")).call(x,s);if(r&&a){A.append("path").style("fill",function(t){return t.color}).style("visibility","hidden").attr("opacity","0.5")}w.call(g,r?false:this.mono());w=A.merge(w);w.select("rect"+u("bar",true)).call(k,s);w.select("text"+u("bar",true)).call(b,s);if(p){var N=void 0;var F=1;var T=F/2;A.append("rect").attr("class",u("diff")).attr("stroke-dasharray","5, 3").attr("stroke-width",F);A.append("text").attr("class",u("diff"));w.each(function(e,i,r){if(i>0){e.neighbor=N;var n={value:e.value-N.value,upward:e.upward};if(s){n.x=e.x;n.w=e.w;if(n.value>0){n.y=e.y;n.h=N.y-e.y}else{n.y=N.y;n.h=e.y-N.y}}else{n.y=e.y;n.h=e.h;if(n.value>0){n.x=N.w;n.w=e.w-N.w}else{n.x=e.w;n.w=N.w-e.w}}n.x+=T;n.y+=T;n.h-=F;n.w-=F;n.w=Math.max(F*2,n.w);n.h=Math.max(F*2,n.h);n.text=c(n.value,true);t.select(this).select("text"+u("bar",true)).each(function(e){var i=t.select(this).transition(l);if(n.value<0){if(s){i.attr("y",(e.upward?e.y:e.y+e.h)-n.h)}else{i.attr("x",(e.upward?e.x+e.w:e.x)+n.w)}}});t.select(this).select("rect"+u("bar",true)).transition(l).style("fill",function(t){return t.color=_[(n.value>0?"inc":"dec")+"Fill"]});t.select(this).select("rect"+u("diff",true)).datum(n).attr("x",s?n.x+T:0).attr("y",s?e.upward?e.y+e.h:e.y:n.y+T).attr("width",s?e.w-F:0).attr("height",s?0:e.h-F).call(k).style("stroke",_[(n.value>0?"inc":"dec")+"Stroke"]);t.select(this).select("text"+u("diff",true)).datum(n).call(x,s).call(b,s).style("fill",_[(n.value>0?"inc":"dec")+"Fill"]);e.diff=n}else{e.neighbor=t.select(r[i+1]).datum();t.select(this).select("rect"+u("bar",true)).transition(l).style(_.neuFill);t.select(this).select("rect"+u("diff",true)).remove()}N=e})}if(r&&a){var O=t.local();z.each(function(i,r,n){var a=t.select(r<n.length-1?n[r+1]:n[r-1]).datum();var s=a.children;t.select(this).selectAll(e.nodeName()).each(function(t){var e=s.find(function(e){return e.data.key===t.data.key});t.neighbor=e})});z.filter(function(t,e,i){return e<i.length-1}).selectAll(e.nodeName()).select("path").style("fill",function(t){return t.color}).each(function(t){t.diff={value:t.neighbor.value-t.value};var e=t.parent;var i=t.neighbor;var r=i.parent;var n=[];if(s){n.push([t.x+t.w,t.y]);n.push([r.x+i.x-e.x,r.y-e.y+i.y]);n.push([n[1][0],n[1][1]+i.h]);n.push([n[0][0],n[0][1]+t.h])}else{n.push([t.x,t.y+t.h]);n.push([n[0][0]+t.w,n[0][1]]);n.push([r.x+i.x+i.w-e.x,n[0][1]+r.y+i.y-e.y-t.y-t.h]);n.push([n[2][0]-i.w,n[2][1]])}var a=s?[n[0],n[3]]:[n[0],n[1]];a="M"+a[0]+"L"+(s?a[0]:a[1])+"L"+a[1]+"L"+(s?a[1]:a[0])+"z";var o=n.map(function(t,e){return(e===0?"M":"L")+t}).join("")+"z";O.set(this,{source:a,target:o})});w.on("mouseenter.stacked",function(i){w.filter(function(t){return t.data.key!==i.data.key}).selectAll("rect"+u("bar",true)).transition().style("fill","#b2c0d1");var r=z.selectAll(e.nodeName()).filter(function(t){return t.data.key===i.data.key});if(!d){t.select(this).select("text"+u("bar",true)).style("visibility","visible");r.select("text"+u("bar",true)).style("visibility","visible")}r.select("path").style("visibility","visible").attr("d",function(){var t=O.get(this);if(t)return t.source}).interrupt().transition(l).attr("d",function(){var t=O.get(this);if(t)return t.target})}).on("mouseleave.stacked",function(i){w.filter(function(t){return t.data.key!==i.data.key}).selectAll("rect"+u("bar",true)).transition().style("fill",function(t){return t.color});var r=z.selectAll(e.nodeName()).filter(function(t){return t.data.key===i.data.key});if(!d){t.select(this).select("text"+u("bar",true)).style("visibility","hidden");r.select("text"+u("bar",true)).style("visibility","hidden")}r.select("path").interrupt().transition(l).attr("d",function(){var t=O.get(this);if(t)return t.source}).on("end",function(){t.select(this).style("visibility","hidden")})})}}function br(){var t=this;var e=this.__execs__.scale;var i=this.isNested();var r=this.grid();var n=this.innerSize();var a=this.__execs__.field;var s=this.isVertical();var o=function r(n){var o=i?a.region:s?a.x:a.y;var l=i?e.region:s?e.x:e.y;o.axis(n);var c=t.axisDefault(l,n);if(n.orient==="bottom"){c.y(s?e.y.range()[0]:e.x.range()[1])}return c};var l=function o(l){var c=s?a.y:a.x;var u=s?e.y:e.x;c.axis(l);var h=t.axisDefault(u,l);h.grid(r).gridSize(l.orient==="bottom"||l.orient==="top"?n.height:n.width);if(l.orient==="right")h.x((i?e.region:e.x).range()[1]);return h};var c=this.axisX();var u=this.axisY();if(this.isFacet()){this.axisFacet(false)}else{if(c)o(c);if(u)l(u)}this.renderAxis()}function wr(){var t=this.__execs__.field;if(this.mono()&&(!t.region||this.isFacet())){return}this.renderLegend("x")}function zr(){var t=this.aggregated();var e=this.isNested.call(this);var i=this.__execs__.scale;var r=this.stacked();var n=this.facet();var a=this.isVertical();var s=this.isFacet();var o=function s(o){if(t)return;var l=e?[i.region(o.data.key),0]:[0,0];if(n&&!r&&n.orient==="vertical"){l.reverse()}else if(!a&&n.orient!=="horizontal"){l.reverse()}var c=l[0];var u=l[1];o.x=c;o.y=u};this.renderRegion(o,function(t){return t},s)}function Ar(){var t=this;var e=this;var i=this.__execs__.scale;var r=this.facet();var n=this.__execs__.canvas;var a=this.mono();var s=this.innerSize();var o=[this.dimensions()[0]];var l=this.isMixed()?[I]:this.measures();var c=void 0,u=void 0;var h=["axisTitles","normalized","padding","orient","font","label","grid","tooltip"].map(function(e){return{key:e,value:t[e]()}});var f=this.axisX();var d=this.axisY();var v=function t(n){var s=Er().container(this).data(n).dimensions(o).measures(l).width(c).height(u).legend(false).zeroMargin(true).aggregated(true).parent(e);h.forEach(function(t){s[t.key](t.value)});if(!a)s.color(i.color(n.data.key));if(r.orient==="vertical"){if(f)s.axis({target:"x",orient:"bottom"});if(d)s.axis({target:"y",orient:"left"})}else{if(f)s.axis({target:"x",orient:"bottom"});if(d)s.axis({target:"y",orient:"left"})}s.render()};if(r.orient==="horizontal"){c=i.region.bandwidth();u=s.height}else{c=s.width;u=i.region.bandwidth()}n.selectAll(this.regionName()+".facet").each(v)}function Nr(){if(!this.tooltip()||this.isFacet())return;var t=this.parent();var e=this.isMixed();var i=this.__execs__.field;var r=this.stacked()&&this.isNested()&&!this.isFacet();var n=this.isVertical();var a=this.showDiff()&&!this.isNested();var s=function t(e,i){return{name:"key",value:i}};var o=function r(n,a){var s=void 0;if(e){s=n.key}else if(t&&t.isMixed()){s=n.key}else{s=i.y.field()}return{name:s,value:a}};var l=function t(e){var i=e.neighbor;var r=[{name:(a?e:e.parent).data.key,value:e.text},{name:(a?i:i.parent).data.key,value:i.text}];if(a)r.reverse();var n=e.diff?e.diff.value:i.diff.value;r.push({name:"(+/-)",value:n});return r};var c=function t(e){var i=0,a=0;if(r){i=Math.max(-e.x+e.neighbor.x+e.neighbor.w,e.w);if(n){if(e.neighbor.parent.x>e.parent.x)i+=Math.abs(e.neighbor.parent.x-e.parent.x)-e.w}else{var s=e.neighbor.parent.y-e.parent.y;if(s<0){i=e.w}else{a+=e.h+(s-e.h)/2}}}else{i+=e.w}return{x:i,y:a}};var u={key:s,offset:c};if(r||a){u.value=l;u.showDiff=true}else{u.value=o}this.renderTooltip(u)}function Fr(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;t.attr("transform",function(t){if(i){if(r)return"translate("+[e.width,e.height]+")";return"translate("+[e.width,t.y-.5]+")"}else{if(r)return"translate("+[0,0]+")";return"translate("+[t.w+.5,0]+")"}})}function Tr(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;if(i){t.attr("x1",-e.width)}else{t.attr("y2",e.height)}}function Or(){if(!this.annotation()||this.isFacet()||this.stacked())return;var e=this.annotation();var i=this;var r=this.__execs__.canvas;var n=t.transition().duration(this.transition().duration).delay(this.transition().delay);var a=this.innerSize();var s=this.isVertical();var o=this.showDiff()&&!this.isNested();if(r.select(".annotation-g").empty())r.append("g").attr("class","annotation-g");var l=r.select(".annotation-g");var c=l.selectAll(".annotation").data(this.nodes().data());c.exit().remove();var u=c.enter().append("g").attr("class","annotation").call(Fr,a,s,true).style("pointer-events","none");u.append("text").style("fill",e.color);u.append("line").style("stroke",e.color).style("shape-rendering","crispEdges").call(Tr,a,s);c=u.merge(c).transition(n).call(Fr,a,s);if(o){c.style("visibility",function(e,i,r){if(e.diff){if(e.diff.value<0)return"visible";else if(i<c.size()-1&&t.select(r[i+1]).datum().diff.value>0)return"visible";if(e.neighbor.diff.value>0)return"visible"}return"hidden"})}c.select("text").text(function(t){return t.key}).style("visibility",e.showLabel?"visible":"hidden").style("fill",e.color).each(function(){i.styleFont(this)});c.select("line").transition(n).style("stroke",e.color).call(Tr,a,s)}var Sr=["vertical","horizontal"];var Mr=["normal","count","mixed"];var Lr={annotation:false,mono:true,orient:Sr[0],padding:.05,showDiff:false,regionPadding:.1};var Dr=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(Lr);return t}r(e,[{key:"measureName",value:function t(){var e=this.measures();var i=void 0;if(this.condition()===Mr[2])i=I.field;else if(this.aggregated()&&e[0].field===I.field)i=e[0].field;else i=e[0].field+"-"+e[0].op;return i}},{key:"renderLayout",value:function t(e){this.reset(e);this.renderFrame();yr.call(this);xr.call(this,e);this.renderCanvas();br.call(this);zr.call(this);if(this.isFacet()){Ar.call(this)}else{kr.call(this)}wr.call(this);Nr.call(this);Or.call(this)}},{key:"muteToLegend",value:function t(e){this.muteLegend(this.isFacet()?e.parent.data.key:e.data.key)}},{key:"muteFromLegend",value:function t(e){if(this.isFacet())this.muteRegions(e.key);else this.muteNodes(e.key)}},{key:"demuteToLegend",value:function t(e){this.demuteLegend(this.isFacet()?e.parent.data.key:e.data.key)}},{key:"demuteFromLegend",value:function t(e){if(this.isFacet())this.demuteRegions(e.key);this.demuteNodes(e.key)}},{key:"isCount",value:function t(){return this.condition()===Mr[1]}},{key:"isFacet",value:function t(){return this.facet()&&this.isNested()&&!this.stacked()}},{key:"isMixed",value:function t(){return this.condition()===Mr[2]}},{key:"isNested",value:function t(){var e=this.dimensions();var i=this.condition();return e.length===2||i==Mr[2]&&e.length===1}},{key:"isVertical",value:function t(){return this.orient()===Sr[0]}}]);return e}(x(sr).with(fr,lr,vr));Dr.prototype.annotation=p("annotation",{showLabel:true,color:"#477cd2"});Dr.prototype.showDiff=p("showDiff",{neuFill:"#c0ccda",incStroke:"#477cd2",incFill:"#40bbfb",decStroke:"#f06292",decFill:"#f06292"});Dr.prototype.mono=d("mono");Dr.prototype.orient=d("orient");var Er=b(Dr);function Cr(t){if(!arguments.length)return this.__attrs__.brushGen;this.__attrs__.brushGen=t;var e=this.__execs__.brushDispatch;t.on("start.brushable",function(){e.apply("brushStart",this,arguments)}).on("brush.brushable",function(){e.apply("brushed",this,arguments)}).on("end.brushable",function(){e.apply("brushEnd",this,arguments)});return this}function jr(t,e){var i=this.brushGen();t.call(i.move,e);return this}var Rr={brush:false,brushGen:null};var Pr=function e(r){var n=function(e){a(r,e);function r(){i(this,r);var e=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));e.setAttrs(Rr);e.__execs__.brush=null;e.__execs__.brushDispatch=t.dispatch("brushStart","brushed","brushEnd");e.rebindOnMethod(e.__execs__.brushDispatch);return e}return r}(r);n.prototype.brush=d("brush");n.prototype.brushGen=Cr;n.prototype.brushMove=jr;return n};var Br={fitLine:false};var Ir=function t(e){var r=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(Br);return t}return e}(e);r.prototype.fitLine=d("fitLine");return r};function Hr(t){if(!arguments.length||t===false)return this.__attrs__.seriesName;else if(typeof t==="boolean"&&t){return this.__attrs__.seriesName.split(".").join(" ").trim()}else if(typeof t==="string"){this.__attrs__.seriesName=t}return this}var Vr=["linear","stepped","curved"];var Gr={curve:Vr[0],point:false,pointRatio:3,seriesName:u("mark series",true)};var Xr=function t(e){var r=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(Gr);return t}return e}(e);r.prototype.seriesName=Hr;r.prototype.curve=d("curve");r.prototype.point=d("point");r.prototype.pointRatio=d("pointRatio");return r};function Yr(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(e){return t.max(this.__execs__.munged,function(t){return t.children.length})}else{return this.__execs__.munged.length}}function Jr(t){var e=["normal","brush"];if(!arguments.length)return this.__attrs__.zoom;if(typeof t==="boolean"){if(t)this.__attrs__.zoom="normal";else this.__attrs__.zoom=false}else if(typeof t==="string"){if(e.findIndex(function(e){return e.localeCompare(t)===0})>=0){this.__attrs__.zoom=t}}return this}function Wr(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var e=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:2;var r=this.pointNum(t);var n=this.__execs__.scale;var a=n.x.range();var s=Math.abs(a[1]-a[0]);if(e){var o=n.y.range();var l=Math.abs(o[1]-o[0]);if(s>l)s=l}var c=r*r/s;return[1,Math.ceil(c*i)]}function Kr(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var r=this.zoomGen();var n=this;var a=this.__execs__.field;var s=this.__execs__.axis;var o=s&&s.x?s.x[a.x.field()]:null;var l=this.__execs__.scale;var c=l.x;var u=i&&s&&s.y?s.y[a.y.field()]:null;var h=i?l.y:null;var f=function t(e){var r=e.rescaleX(c);l.x=r;if(o){o.scale(r);o.render(null,true)}if(i){var n=e.rescaleX(h);l.y=n;if(u){u.scale(n);u.render(null,true)}}};r.on("zoom.zoomable.zoomed",function(){var i=t.event.transform;if(!i)return;f(i);if(n.__execs__.tooltip)n.__execs__.tooltip.hide();e()});return this}function qr(t){if(!arguments.length)return this.__attrs__.zoomGen;this.__attrs__.zoomGen=t;var e=this;var i=e.__execs__.zoomDispatch;t.on("zoom.zoomable",function(){i.apply("zoom",this,arguments)});return this}function Zr(t,e){t.call(this.zoomGen().transform,e);return this}var Ur={zoom:false,zoomGen:null};var Qr=function e(r){var n=function(e){a(r,e);function r(){i(this,r);var e=s(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));e.setAttrs(Ur);e.__execs__.zoom=null;e.__execs__.zoomDispatch=t.dispatch("zoom");e.rebindOnMethod(e.__execs__.zoomDispatch);return e}return r}(r);n.prototype.pointNum=Yr;n.prototype.zoom=Jr;n.prototype.zoomed=Kr;n.prototype.zoomExtent=Wr;n.prototype.zoomGen=qr;n.prototype.zoomTransform=Zr;n.prototype.isBrushZoom=$r;_(n,Ur);return n};function $r(){return this.__attrs__.zoom&&this.__attrs__.zoom==="brush"}var tn={shape:null};var en=function t(e){var r=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(tn);return t}return e}(e);r.prototype.shape=d("shape");return r};function rn(){if(!this.brush())return;var e=this.__execs__.canvas;var i=this.innerSize();var r=t.brushX().extent([[0,0],[i.width,i.height]]);var n=e.selectAll(".brush.x").data([i]);n.exit().remove();n.enter().append("g").attr("class","brush x").merge(n).attr("transform","translate("+[0,0]+")").call(r);this.brushGen(r)}function nn(){var t=this.__execs__.field;if(!t.region){return}this.renderLegend()}function an(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:.75;var r=this;var n=this.innerSize();var a=Math.round(n.height*i);var s=n.height-a;var o=["axis","axisTitles","color","curve","multiTooltip","normalized","padding","point","pointRatio","regionPadding","shape","size","stacked","grid","font","label","tooltip"].map(function(t){return{key:t,value:e[t]()}});var l=[];var c=function t(e,i){e.x=0;e.y=i===0?0:a};var u=this.renderRegion(c,[{h:a},{h:s}],true);u.each(function(t,e){var i=Vn().container(this).data(r.data()).dimensions(r.dimensions()).measures(r.measures()).width(n.width).height(t.h).legend(false).zeroMargin(true).parent(r);o.forEach(function(t){return i[t.key](t.value)});if(e==0){var a=i.axis().find(function(t){return t.target==="x"});if(a)a.showTitle=false;i.brush(false).zoom("normal")}else{i.multiTooltip(false).tooltip(false).brush(true).point(false)}i.render();l.push(i)});if(this.isNested()){var h=this.__execs__.field.region.munged(this.__execs__.munged).level(0).domain();this.scale().color=t.scaleOrdinal().domain(h).range(this.color());nn.call(this)}var f=l[1].__execs__.scale.x;var d=l[1].__execs__.canvas.select(".brush.x");var v=l[0].__execs__.scale.x;var _=this.__execs__.canvas;l[0].on("zoom.line",function(){if(t.event.sourceEvent&&(t.event.sourceEvent.type==="zoom"||t.event.sourceEvent.type==="end"||t.event.sourceEvent.type==="brush"))return;var e=t.event.transform.rescaleX(f).domain();l[1].brushMove(d,e.map(f))});l[1].on("brushed.line brushEnd.line",function(){if(t.event.sourceEvent&&t.event.sourceEvent.type==="brush")return;var e=t.event.selection||f.range();var i=e.map(f.invert);e=i.map(v);l[0].zoomTransform(_,t.zoomIdentity.scale((v.range()[1]-v.range()[0])/(e[1]-e[0])).translate(-e[0],0))})}function sn(){var e=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var i=this;var r=this.__execs__.canvas;var n=this.__execs__.field;var a=this.isNested.call(this);var s=this.__execs__.scale;var o=this.isStacked();var l=this.color();var h=this.label();var f=this.isIndividualScale();var d=this.size();var v=this.point();var _=this.pointRatio();var p=e?t.transition().duration(0).delay(0):t.transition().duration(this.transition().duration).delay(this.transition().delay);var g=this.shape()===Pn[1];var m=this.measureName();var y=this.curve()===Vr[0]?t.curveLinear:this.curve()===Vr[1]?t.curveStep:t.curveCatmullRom;var x=this.scaleBandMode();var k=this.multiTooltip();var b=function t(e){return s.x(n.x.interval()?new Date(e.data.key):e.data.key)+(x?s.x.bandwidth()/2:0)};var w=function t(e){return function(t){return o?e(t.data.value[m+"-end"]):e(t.data.value[m])}};var z=t.line().x(b).y(t.max(s.y.range())).curve(y);var A=function e(i){return t.line().x(b).y(w(i)).curve(y)};var N=t.area().x(b).y(t.max(s.y.range())).curve(y);var F=function e(i){return t.area().x(b).y0(function(e){return o?s.y(e.data.value[m+"-start"]):t.max(s.y.range())}).y1(w(i)).curve(y)};var T=function e(i){var r=function e(i){var r=n.x.isInterval()?t.timeFormat(n.x.format()):null;return r?r(i):i};i.each(function(t,e,i){t.value=o?t.data.value[m+"-end"]:t.data.value[m];t.x=b(t);t.y=w(f?t.parent.scale:s.y)(t);t.anchor=e===0?"start":e===i.length-1?"end":"middle";t.text=c(t.value);t.color=t.parent.color;t.key=r(t.data.key)})};var O=function t(e){e.each(function(t,e,i){var r=true;if(e<i.length-1&&i[e+1]){var n=i[e+1];r=n.y<=t.y}t.upward=r})};var S=function e(i){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(r){i.each(function(e){var i=e.children;t.select(this).attr("d",N(i)).attr("fill-opacity",.4).style("stroke","none")})}else{i.each(function(e){var i=e.children;t.select(this).attr("d",z(i)).style("fill","none")})}};var M=function e(i){var r=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var n=function t(e){return a?s.color(e.data.key):l[0]};if(r){i.each(function(e){var i=e.children;t.select(this).transition(p).attr("d",F(f?e.scale:s.y)(i))}).attr("fill",n).attr("stroke","none")}else{i.each(function(e){var i=e.children;t.select(this).transition(p).attr("d",A(f?e.scale:s.y)(i))}).attr("stroke",n).attr("stroke-width",d.range[0]+"px")}};var L=function e(i){i.attr("r",(d.range[0]-d.range[0]/4)*_).attr("stroke-width",d.range[0]/4*_).style("fill","#fff").attr("opacity",v?1:0).style("cursor","pointer").attr("cx",function(t){return t.x}).attr("cy",t.max(s.y.range()))};var D=function t(e){e.transition(p).attr("r",(d.range[0]-d.range[0]/4)*_).attr("stroke-width",d.range[0]/4*_).attr("opacity",v?1:0).attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})};var E=function e(r){r.each(function(e){var r=t.select(this);r.attr("x",e.x).attr("y",t.max(s.y.range())).attr("stroke","none").text(e.text);i.styleFont(r)})};var C=function e(r){r.each(function(e){var r=t.select(this);r.attr("text-anchor",e.anchor).style("pointer-events",k?"none":"all").transition(p).attr("y",e.y+(d.range[0]/2*_+1)*(e.upward?1:-1)).attr("x",e.x).attr("dy",e.upward?".71em":0).style("visibility",h?"visible":"hidden").text(e.text);i.styleFont(r)})};var j=function t(e){var r=e.select(i.seriesName());if(r.empty()){r=e.append("g").attr("class",i.seriesName(true))}var n=function t(e,i){var r=e.selectAll("path"+u(i?"area":"line",true)).data(function(t){return[t]});r.exit().remove();r.enter().append("path").attr("class",u(i?"area":"line")).call(S,i).merge(r,i).call(M,i).style("pointer-events","none")};if(g){r.call(n,true)}else{r.selectAll("path"+u("area",true)).remove()}r.call(n,false)};var R=function t(e){e.attr("fill",function(t){return t.color}).attr("stroke",function(t){return t.color});var r=e.selectAll(i.nodeName()).data(function(t){return t.children},function(t){return t.data.key});r.exit().remove();var n=r.enter().append("g").attr("class",i.nodeName(true)).call(T);n.append("circle").call(L);n.append("text").call(E);r.call(T);r=n.merge(r).call(O);r.select("circle").call(D);r.select("text").call(C)};var P=r.selectAll(this.regionName());P.each(function(){t.select(this).each(function(t){t.children.sort(function(t,e){return b(t)-b(e)})}).call(j).call(R)})}function on(){var e=this;var i=function t(e,i){var r=this.__execs__.field;if(e.length<=2&&i.length<2){if(e[1])r.region=gr(e[1]);r.x=gr(e[0]);if(i.length===0)this.measure(B);r.y=G(i[0]);if(i.length===0)return Bn[1];else if(i.length===1)return Bn[0]}else if(e.length===1&&i.length>=2){r.region=gr(this.mixedDimension());r.x=gr(e[0]);r.y=G(I).mixed(true).measures(i);return Bn[2]}else throw new A};this.condition(i);var r=this.__execs__.field;var n=this.isMixed();if(this.aggregated()){this.__execs__.munged=[this.data()]}else if(n){this.__execs__.munged=this.aggregateMixed(true)}else{this.__execs__.munged=this.aggregate(true);if(!this.isNested()){this.__execs__.munged=[this.__execs__.munged[0].parent]}}if(this.isStacked()){var a=this.__execs__.munged;var s=a[0].children.map(function(t){return t.data.key});a.forEach(function(t,e){if(e>0){t.children.sort(O("ascending",s,true,function(t){return t.data.key}))}});var o=a.map(function(t){return t.children});o=t.zip.apply(null,o);o.forEach(function(t){M(t,r.y,e.normalized())})}}function ln(e,i){var r=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var n=i.field();var a=e.children.map(function(t){return t.data.value[n]});a=t.extent(a);if(r<=0)return a;var s=Math.abs(a[0]-a[1]);s*=r*.5;return[a[0]-s,a[1]+s]}function cn(e){var i=this;var r=this.scale();var n=this.__execs__.munged;var a=this.isIndividualScale();var s=this.isNested();var o=this.isStacked();var l=this.facet();var c=this.aggregated();var u=this.__execs__.field;var h=this.isMixed();var f=1;var d=this.axisX();var v=this.axisY();var _=void 0,p=void 0;var g=void 0;r.y=t.scaleLinear();if(s){g=u.region.level(0).munged(n).domain();r.color=this.updateColorScale(g,e)}if(this.isFacet()){r.region=t.scaleBand().domain(g).padding(this.regionPadding());if(l.orient==="horizontal"&&d){d.orient="top";d.showDomain=false;this.thickness(d,r.region,true,true);if(v)v.thickness=0}else if(l.orient==="vertical"&&v){v.orient="right";v.showDomain=false;this.thickness(v,r.region,false,true);if(d)d.thickness=0}var m=this.innerSize();if(l.orient==="vertical"){r.region.rangeRound([0,m.height])}else{r.region.rangeRound([0,m.width])}return}p=u.x.munged(n).level(f).domain();_=u.y.munged(n).level(f).aggregated(c).domain(0,o);var y=true;for(var x=0;x<p.length;x++){var k=p[x];if(isNaN(k)){y=false;break}}var b=false;if(this.scaleBandMode()){r.x=t.scaleBand().padding(this.padding());b=true}else if(u.x.interval()||y){if(u.x.order()==="natural"){if(p[0]instanceof Date)p=t.extent(p);else p=t.extent(p.map(function(t){return+t}))}else{p=[p[0],p[p.length-1]]}r.x=L(p,null,u.x)}else{r.x=t.scalePoint().padding(this.padding());b=true}r.x.domain(p);this.setCustomDomain("y",_);if(h&&a&&v){v.orient="left";n.forEach(function(e){var r=ln(e,u.y,i.padding());e.scale=t.scaleLinear().domain(r).nice();e.scale._defaultDomain=r;if(i.isMixed()){var n=i.measures().find(function(t){return t.field===e.data.key});if(n&&n.customDomain){e.scale._defaultDomain=r;e.scale.domain(n.customDomain)}}});this.thickness(v,n[0].scale,false,false);var w=Object.assign({},v);w.orient="right";this.axis(w);this.thickness(w,n[n.length-1].scale,false,false)}else if(v){var z=this.axis().find(function(t){return t.target==="y"&&t.orient!==v.orient});if(z)this.axis(z,false);this.thickness(v,r.y,false,false)}this.thickness(d,r.x,true,b);var A=this.innerSize();r.x.range([0,A.width]);if(y&&!this.scaleBandMode()){var N=this.padding();N=A.height*N/2;var F=A.width-N;if(p[0]===p[1]||p[1]-p[0]===0){var T=(N+F)/2;r.x.range([T,T])}else{r.x.range([N,F])}}r.y.range([A.height,0]);if(a){n.forEach(function(t){t.scale.range([A.height,0])})}}function un(){var t=this;var e=this.__execs__.munged;var i=this.__execs__.scale;var r=this.grid();var n=this.isIndividualScale();var a=this.innerSize();var s=this.__execs__.field;var o=function e(n){s.x.axis(n);var o=t.axisDefault(i.x,n);if(i.x.invert)o.grid(r).gridSize(a.height);if(n.orient==="bottom")o.y(i.y.range()[0]);return o};var l=function e(n){var o=arguments.length>1&&arguments[1]!==undefined?arguments[1]:i.y;var l=arguments[2];if(!l){s.y.axis(n)}else{n.field=l}var c=t.axisDefault(o,n);c.grid(r).gridSize(a.width);if(n.orient==="right")c.x(i.x.range()[1]);return c};var c=this.axisX();var u=this.axisY();if(this.isFacet()){this.axisFacet()}else{if(c){o(c)}if(u){if(n){var h=this.axis().filter(function(t){return t.target==="y"});if(e.length<=2){h.forEach(function(t,i){return l(t,e[i].scale,e[i].data.key)})}}else{l(u)}}}this.renderAxis()}var hn="#aaa";function fn(){var e=this.__execs__.canvas;var i=e.select(".mean-line-g");if(!(typeof this.meanLine()==="number")&&(!this.meanLine()||this.isFacet())){i.remove();return}var r=this.meanLine();var n=[];var a=this.__execs__.scale;var s=t.transition().duration(this.transition().duration).delay(this.transition().delay);if(typeof r==="number"){var o=a.y.domain();if(r>=o[0]&&r<=o[1]){n.push({value:r,y:a.y(r)})}}else{this.regions().filter(function(t){if(typeof r==="string"){return t.data.key===r}else{return true}}).each(function(e){var i={value:t.mean(e.children,function(t){return t.value})};i.y=a.y(i.value);n.push(i)})}if(i.empty){i=e.append("g").attr("class","mean-line-g")}var l=i.selectAll(".mean-line").data(n);l.exit().remove();var c=l.enter().append("g").attr("class","mean-line").attr("transform","translate("+[0,a.y.range()[0]]+")").style("pointer-events","none");c.append("line").attr("stroke",hn).attr("shape-rendering","crispEdges").attr("stroke-width","2px").attr("x2",a.x.range()[1]);l=c.merge(l).transition(s).attr("transform",function(t){return"translate("+[0,t.y]+")"});l.select("line").transition(s).attr("x2",a.x.range()[1])}function dn(){var t=this.aggregated();var e=this.__execs__.canvas;var i=this.isNested();var r=this.__execs__.scale;var n=this.stacked();var a=this.facet();var s=this.isFacet();var o=this.color();var l=function e(s){if(t)return;var l=void 0;if(!i){l=[0,0]}else if(a&&!n){l=[r.region(s.data.key),0];if(a.orient==="vertical"){l.reverse()}}else{l=[0,0]}s.x=l[0];s.y=l[1];s.color=i?r.color(s.data.key):o[0]};if(!s&&this.multiTooltip()){var c=e.select(".multi-tooltip-g");if(c.empty())c=e.append("g").attr("class","multi-tooltip-g")}this.renderRegion(l,function(t){var e=n?t.slice().reverse():t;return e},s)}function vn(){var t=this;var e=this;var i=this.__execs__.scale;var r=this.facet();var n=this.__execs__.canvas;var a=this.innerSize();var s=[this.dimensions()[0]];var o=this.isMixed()?[I]:this.measures();var l=void 0,c=void 0;var u=["axisTitles","curve","meanLine","multiTooltip","normalized","padding","point","pointRatio","regionPadding","shape","size","grid","font","label"].map(function(e){return{key:e,value:t[e]()}});var h=this.axisX();var f=this.axisY();var d=[];var v=function t(r){var n=Vn().container(this).data(r).dimensions(s).measures(o).width(l).height(c).legend(false).tooltip(false).parent(e).zeroMargin(true).aggregated(true).color(i.color(r.data.key));u.forEach(function(t){return n[t.key](t.value)});if(f)n.axis({target:"y",orient:"left"});if(h)n.axis({target:"x",orient:"bottom"});n.render();d.push(n)};if(r.orient==="horizontal"){l=i.region.bandwidth();c=a.height}else{l=a.width;c=i.region.bandwidth()}n.selectAll(".facet").each(v);d.forEach(function(t){t.on("selectStart.facet selectMove.facet selectEnd.facet",function(e){d.forEach(function(i){if(i!==t){i.showMultiTooltip(e)}})})})}var _n="#c0ccda";function pn(){var e=this.__execs__.canvas;var i=this.__execs__.scale;var r=t.transition().duration(this.transition().duration).delay(this.transition().delay);var n=this.fitLine();var a=e.selectAll(u("fit-line-g",true));if(!n||!i.x.invert){if(!a.empty())e.select(u("fit-line-g",true)).remove();return}var s=this.leastSquare(n);var o=i.x.domain();var l=s.map(function(t){return o.map(function(e){return t.slope*e+t.intercept})});if(a.empty()){a=e.append("g").attr("class",u("fit-line-g")).attr("clip-path","url(#"+e.selectAll(u("canvas-g-clip-path",true)).attr("id"))}a.datum(l);var c=a.selectAll(u("fit-line",true)).data(function(t){return t});c.exit().remove();var h=c.enter().append("line").attr("class",u("fit-line")).style("fill","none").style("stroke",_n).style("stroke-width",1).attr("x1",i.x(o[0])).attr("x2",i.x(o[1])).attr("y1",function(t){return(t.scale?t.scale:i.y).range()[0]}).attr("y2",function(t){return(t.scale?t.scale:i.y).range()[0]});c=h.merge(c);c.transition(r).attr("x1",i.x.range()[0],i.x(o[0])).attr("x2",i.x(o[1])).attr("y1",function(t){return(t.scale?t.scale:i.y)(t[0])}).attr("y2",function(t){return(t.scale?t.scale:i.y)(t[1])})}var gn={"font-family":"sans-serif","font-size":12,"font-weight":"normal","font-style":"normal"};var mn="#fff";var yn="#b0bec5";var xn={anchor:{x:"left",y:"top"},color:yn,dx:0,dy:0,height:null,font:gn,nodeName:u("mark node",true),tooltip:null,target:null,valueFormat:null,width:null,sortByValue:{type:"natural"},x:0,y:0};var kn=function e(){i(this,e);this.__attrs__=JSON.parse(JSON.stringify(xn));this.__execs__={tooltip:null,domain:null,dispatch:t.dispatch("start","move","end")};this.valueFormat(c);h(this,this.__execs__.dispatch)};function bn(){return new kn}function wn(e){var i=this;var r=this.__execs__.domain;var n=this.__execs__.dispatch;var a=t.bisector(function(t){return t.x}).right;var s=null;var o=function o(){var l=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var c=e.node().getBoundingClientRect().left;var u=t.event.x-c;var h=a(r,u);if(h>0&&h<r.length){var f=Math.abs(u-r[h-1].x);var d=Math.abs(r[h].x-u);if(f<d)h=h-1}h=Math.max(0,Math.min(r.length-1,h));var v=r[h];if(!s||v.x!==s.x||l){Fn.call(i,e,v);n.call(l?"start":"move",this,v);s=v}};e.on("mouseenter.multi-tooltip",function(){o(true)}).on("mousemove.multi-tooltip",function(){o(false)}).on("mouseleave.multi-tooltip",function(){An.call(i,e);n.call("end",this);s=null})}function zn(){var t=this.target();var e=t.__execs__.canvas.selectAll(this.nodeName());var i=[];e.each(function(t){var e=i.find(function(e){return e.x===t.x});if(e){e.points.push(this)}else{i.push({x:t.x,points:[this],value:t.key})}});this.__execs__.domain=i.sort(function(t,e){return t.x-e.x})}function An(e){var i=t.transition().duration(180);e.select(u("baseline",true)).transition(i).attr("opacity",0);var r=this.target();var n=r.nodes().filter(function(){return t.select(this).classed(u("show"))}).classed(u("show"),false).selectAll("circle");if(!r.point())n.attr("opacity",0);else n.style("fill",mn);if(this.tooltip())this.tooltip().hide()}function Nn(t){var e=this.target().innerSize();t.style("fill","none");var i=t.select(u("overlay",true));if(i.empty()){i=t.append("rect").attr("class",u("overlay")).style("cursor","crosshair");t.append("line").attr("class",u("baseline")).attr("opacity",0).attr("shape-rendering","crispEdges").attr("pointer-events","none")}t.select(u("baseline",true)).attr("y1",0).attr("y2",this.height()?this.height():e.height).attr("stroke",yn);i.attr("width",this.width()?this.width():e.width).attr("height",this.height()?this.height():e.height);zn.call(this);wn.call(this,t);this.__execs__.tooltip=t}function Fn(e,i){var r=t.transition().duration(140);var n=this.target();var a=[];if(!n.point()){n.__execs__.canvas.selectAll(this.nodeName()).selectAll("circle").transition(r).attr("opacity",0)}else{n.__execs__.canvas.selectAll(this.nodeName()).selectAll("circle").transition(r).style("fill",mn)}var s=t.selectAll(i.points).each(function(t){var e=t.x;if(e===i.x){a.push({key:t.key,x:t.x,y:t.y,text:t.text})}});s.classed(u("show"),true).selectAll("circle").transition(r).attr("opacity",1).style("fill",function(t){return t.color});var o=e.select(u("baseline",true));o.transition(r).attr("opacity",1).attr("x1",i.x+.5).attr("x2",i.x+.5);var l=this.tooltip();var c=void 0,h=[];var f=[];t.selectAll(i.points).each(function(t){var e=l.__execs__.mark.get(this);c=e.x;h.push(e.y);f.push(t)});Mn(f,this.sortByValue());f=f.map(function(t){return{name:t.parent.data.key||t.data.key,value:t.text}});h=t.mean(h);h=Math.round(h);if(c&&h){l.x(c).y(h).key({name:"key",value:i.value}).value(f).show()}else{l.hide()}}function Tn(){An.call(this,this.__execs__.tooltip);t.dispatch.call("end",this)}function On(e){e=t.select(e);Nn.call(this,e)}function Sn(t){var e=this.__execs__.tooltip;var i=this.__execs__.domain;if(t!==undefined&&t!==null){var r=i.find(function(e){return e.value==t.value});Fn.call(this,e,{x:r?r.x:t.x,points:r?r.points:null,value:r?r.value:null})}else{An.call(this,e)}}function Mn(e){var i=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"natural";var r=["natural","ascending","descending"];if(r.find(function(t){return t===i})){if(e.length>0){if(i===r[1]){e.sort(function(e,i){return t.ascending(e.value,i.value)})}else if(i===r[2]){e.sort(function(e,i){return t.descending(e.value,i.value)})}}}}kn.prototype.hide=Tn;kn.prototype.render=On;kn.prototype.tick=Sn;_(kn,xn);function Ln(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var e=this.parent();var i=this.__execs__.field;var r=this.isMixed();var n=function t(e,i){return{name:"key",value:i}};var a=function t(n,a){var s=void 0;if(r){s=n.key}else if(e&&e.isMixed()){s=n.key}else{s=i.y.field()}return{name:s,value:a}};return this.renderTooltip({dx:this.size().range[0]+4,value:a,key:n},t)}function Dn(){var t=this.__execs__.canvas;var e=t.select(u("multi-tooltip-g",true));if(e.empty())e=t.append("g").attr("class",u("multi-tooltip-g"));var i=Ln.call(this,true);var r=bn().target(this).dx(this.size().range[0]).dy(this.size().range[0]).color(this.color()[0]).tooltip(i).sortByValue(this.multiTooltip().sortByValue);r.render(e.node());this.__execs__.tooltip=r;var n=this.__execs__.multiTooltipDispatch;r.on("start",function(t){n.call("selectStart",this,t);n.call("multiTooltip",this,t)}).on("move",function(t){n.call("selectMove",this,t);n.call("multiTooltip",this,t)}).on("end",function(){n.call("selectEnd",this);n.call("multiTooltip",this)});return r}function En(){if(!this.isFacet()&&this.multiTooltip())Dn.call(this);else if(this.tooltip()&&!this.multiTooltip())Ln.call(this,false)}function Cn(){var e=this;var i=this.__execs__.scale.x;if(!i.invert)return;var r=this.__execs__.canvas;var n=this.zoomExtent(this.isNested());var a=this.parent();var s=t.zoom().scaleExtent(n).translateExtent([[0,0],[(a?a:this).width(),(a?a:this).height()]]);r.call(s);this.zoomGen(s).zoomed(function(){sn.call(e,true);t.select((a?a:e).__execs__.canvas.node().parentNode.parentNode).selectAll(u("tooltip",true)).remove();En.call(e)})}function jn(){if(!this.zoom())return;if(this.zoom()==="normal")Cn.call(this)}var Rn={range:[2,2],scale:"linear",reverse:false};var Pn=["line","area"];var Bn=["normal","count","mixed"];var In={meanLine:false,multiTooltip:false,padding:0,pointRatio:2,regionPadding:.1,shape:Pn[0],scaleBandMode:false,size:Rn,individualScale:false};var Hn=function(n){a(o,n);function o(){i(this,o);var e=s(this,(o.__proto__||Object.getPrototypeOf(o)).call(this));e.setAttrs(In);e.__execs__.multiTooltipDispatch=t.dispatch("selectStart","selectMove","selectEnd","multiTooltip");e.rebindOnMethod(e.__execs__.multiTooltipDispatch);return e}r(o,[{key:"multiTooltip",value:function t(i){if(!arguments.length)return this.__attrs__.multiTooltip;if(typeof i==="boolean"){if(i){i={sortByValue:"natural"}}}if((typeof i==="undefined"?"undefined":e(i))==="object"){if(!i.sortByValue)i.sortByValue="natural"}this.__attrs__.multiTooltip=i;return this}},{key:"leastSquare",value:function t(e){var i=this.measureName();var r=this.isIndividualScale();return this.__execs__.munged.filter(function(t){if(typeof e==="string"){return t.data.key===e}else{return true}}).map(function(t){var e=t.children.map(function(t){return{x:t.data.key,y:t.data.value[i]}});var n=S(e);if(r&&t.scale){n.scale=t.scale}n.key=t.data.key;return n})}},{key:"measureName",value:function t(){var e=this.measures();var i=void 0;if(this.condition()===Bn[2])i=I.field;else if(this.aggregated()&&e[0].field===I.field)i=e[0].field;else i=e[0].field+"-"+e[0].op;return i}},{key:"isCount",value:function t(){return this.condition()===Bn[1]}},{key:"isFacet",value:function t(){return this.facet()&&this.isNested()&&!this.stacked()}},{key:"isIndividualScale",value:function t(){return this.individualScale()&&this.isNested()&&!this.stacked()}},{key:"isMixed",value:function t(){return this.condition()==Bn[2]}},{key:"isNested",value:function t(){var e=this.dimensions();var i=this.condition();return e.length===2||i==Bn[2]&&e.length===1}},{key:"isStacked",value:function t(){return this.stacked()&&this.isNested()}},{key:"muteFromLegend",value:function t(e){this.muteRegions(e.key)}},{key:"muteToLegend",value:function t(e){this.muteLegend(e.parent.data.key)}},{key:"demuteFromLegend",value:function t(e){this.demuteRegions(e.key)}},{key:"demuteToLegend",value:function t(e){this.demuteLegend(e.parent.data.key)}},{key:"showMultiTooltip",value:function t(e,i){if(this.multiTooltip()){var r=this.__execs__.tooltip;r.tick(e,i)}}},{key:"renderLayout",value:function t(e){this.reset(e);this.renderFrame();on.call(this);if(this.isBrushZoom()){this.noAxisOffset(true);this.renderCanvas();an.call(this);return}cn.call(this,e);this.renderCanvas(this.point()?this.size().range[0]*2:0);un.call(this);dn.call(this);if(this.isFacet()){vn.call(this)}else{sn.call(this)}fn.call(this);pn.call(this);En.call(this);jn.call(this);rn.call(this);nn.call(this)}}]);return o}(x(sr).with(Ir,Xr,Pr,Qr,lr,en,vr));Hn.prototype.meanLine=d("meanLine");Hn.prototype.scaleBandMode=d("scaleBandMode");Hn.prototype.individualScale=d("individualScale");var Vn=b(Hn);function Gn(){var t=function t(e,i){var r=this.__execs__.field;if(i.length<2)throw new A;r.x=G(i[0]);r.y=G(i[1]);if(e.length===0&&i.length===2)return ra[0];else if(e.length===1&&i.length===2){r.region=gr(e[0]);return ra[1]}else if(e.length===0&&i.length===3){r.radius=G(i[2]);return ra[2]}else if(e.length==1&&i.length===3){r.radius=G(i[2]);r.region=gr(e[0]);return ra[3]}else throw new A};this.condition(t);this.limitRows();if(this.aggregated()){this.__execs__.munged=[this.data()]}else if(this.isColor()){this.__execs__.munged=this.aggregate(false,false).map(function(t){t.key=t.data.key;return t})}else{this.__execs__.munged=[this.data().map(function(t){return{data:t}})]}}function Xn(e){var i=this.scale();var r=this.__execs__.munged;var n=this.facet();var a=this.__execs__.field;var s=this.aggregated();var o=this.axisX();var l=this.axisY();var c=void 0,u=void 0;if(this.isColor()){c=a.region.munged(r).domain();i.color=this.updateColorScale(c,e)}if(this.isFacet()){i.region=t.scaleBand().domain(c).padding(this.regionPadding());if(n.orient==="horizontal"&&o){o.orient="top";o.showDomain=false;this.thickness(o,i.region,true,true);if(l)l.thickness=0}else if(n.orient==="vertical"&&l){l.orient="right";l.showDomain=false;this.thickness(l,i.region,false,true);if(o)o.thickness=0}var h=this.innerSize();if(n.orient==="vertical"){i.region.rangeRound([0,h.height])}else{i.region.rangeRound([0,h.width])}return}var f=s?this.data().children:this.data();var d=t.extent(f,function(t){return(s?t.data:t)[a.x.field()]});var v=t.extent(f,function(t){return(s?t.data:t)[a.y.field()]});i.x=L(d,undefined,a.x);i.y=L(v,undefined,a.y);if(this.isSized()){u=t.extent(f,function(t){return t[a.radius.field()]});i.r=t.scaleLinear().domain(u).range(this.size().range)}this.setCustomDomain("x",d);this.setCustomDomain("y",v);this.thickness(l,i.y,false,false);this.thickness(o,i.x,true,false);var _=this.innerSize();i.x.rangeRound([0,_.width]);i.y.rangeRound([_.height,0])}function Yn(){var e=this;var i=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var r=this;var n=this.__execs__.canvas;var a=this.__execs__.scale;var s=this.color();var o=this.size();var l=this.label();var u=t.transition().duration(this.transition().duration).delay(this.transition().delay);var h=this.__execs__.field;var f=this.aggregated();var d=this.isColor();var v=function t(e){return a.x(e.data[h.x.field()])};var _=function t(e){return a.y(e.data[h.y.field()])};var p=function t(i){return e.isSized()?a.r(i.data[h.radius.field()]):o.range[0]};var g=function e(){var i=t.select(this.parentNode).datum();return d?a.color(i.data.key):s[0]};var m=function t(e){e.each(function(t){t.x=v(t);t.y=_(t);t.color=g.call(this);t.r=p(t);t.text=c(t.x)+", "+c(t.y)})};var y=function t(e){e.attr("r",0).attr("stroke",function(t){return t.color}).attr("stroke-width","1px").attr("fill-opacity",.5).style("cursor","pointer")};var x=function t(e){e.transition(u).attr("r",function(t){return t.r}).attr("stroke",function(t){return t.color})};var k=function e(i){i.each(function(e){var i=t.select(this);i.style("pointer-events","none").text(e.text);r.styleFont(i)})};var b=function e(i){i.each(function(e){var i=t.select(this);i.attr("text-anchor",e.anchor).style("visibility",l?"visible":"hidden").transition(u).attr("y",o.range[0]).text(e.text);r.styleFont(i)})};var w=function e(n){var a=n.selectAll(r.nodeName()).data(function(t){return d||f?t.children:t});a.exit().remove();var s=a.enter().append("g").attr("class",r.nodeName(true)+" point").call(m);s.append("circle").call(y);s.append("text").call(k);a=s.merge(a).call(m);a.selectAll("circle").call(x);a.selectAll("text").call(b);a.each(function(e){var r=t.select(this);if(!i)r=r.transition(u);r.attr("transform","translate("+[e.x,e.y]+")").style("fill",e.color)});r.__execs__.nodes=a};n.selectAll(this.regionName()).call(w)}function Jn(){var t=this;var e=this.__execs__.scale;var i=this.grid();var r=this.innerSize();var n=this.__execs__.field;var a=function a(s){n.x.axis(s);var o=t.axisDefault(e.x,s);if(s.orient==="bottom")o.y(e.y.range()[0]);o.grid(i).gridSize(r.height);return o};var s=function a(s){n.y.axis(s);var o=t.axisDefault(e.y,s);if(s.orient==="right")o.x(e.x.range()[1]);o.grid(i).gridSize(r.width);return o};var o=this.axisX();var l=this.axisY();if(this.isFacet()){this.axisFacet()}else{if(o){a(o)}if(l){s(l)}}this.renderAxis()}function Wn(){var t=this.legend();if(!t)return;if(!this.isColor()){return}this.renderLegend()}function Kn(){var t=this.aggregated();var e=this.__execs__.scale;var i=this.isFacet();var r=this.facet();this.renderRegion(function(n){if(t)return;var a=[i?e.region(n.key):0,0];if(r.orient==="vertical")a.reverse();n.x=a[0];n.y=a[1]},function(t){return t},i)}function qn(){var t=this;var e=this;var i=this.__execs__.scale;var r=this.facet();var n=this.__execs__.canvas;var a=this.innerSize();var s=this.measures();var o=void 0,l=void 0;var c=["axisTitles","size","grid","font","label","tooltip"].map(function(e){return{key:e,value:t[e]()}});var u=this.axisX();var h=this.axisY();var f=function t(r){var n=sa().container(this).data(r).measures(s).width(o).height(l).legend(false).zeroMargin(true).aggregated(true).parent(e).color(i.color(r.data.key));c.forEach(function(t){return n[t.key](t.value)});if(h)n.axis({target:"y",orient:"left"});if(u)n.axis({target:"x",orient:"bottom"});n.render()};if(r.orient==="horizontal"){o=i.region.bandwidth();l=a.height}else{o=a.width;l=i.region.bandwidth()}n.selectAll(".facet").each(f)}var Zn="#c0ccda";function Un(){var e=this.__execs__.canvas;var i=e.select(u("fit-line-g",true));if(!this.fitLine()){if(!i.empty())e.select(u("fit-line-g",true)).remove();return}var r=this.__execs__.field;var n=S(this.data(),r.x.field(),r.y.field()),a=n.slope,s=n.intercept;var o=this.scale();var l=t.transition().duration(this.transition().duration).delay(this.transition().delay);var c=o.x.domain();var h=c.map(function(t){return a*t+s});if(i.empty()){i=e.append("g").attr("class",u("fit-line-g")).attr("clip-path","url(#"+e.selectAll(u("canvas-g-clip-path",true)).attr("id"));i.append("line").attr("class",u("fit-line")).style("fill","none").style("stroke",Zn).style("stroke-width",1).attr("x1",o.x(c[0])).attr("y1",o.y.range()[0]).attr("x2",o.x(c[1])).attr("y2",o.y.range()[0])}i.select("line").transition(l).attr("x1",o.x(c[0])).attr("y1",o.y(h[0])).attr("x2",o.x(c[1])).attr("y2",o.y(h[1]))}function Qn(){if(!this.tooltip()||this.isFacet())return;var t=this.measures();var e=function e(i){return t.map(function(t){return{name:t.field,value:t.format?t.format(i.data[t.field]):i.data[t.field]}})};this.renderTooltip({dx:this.size().range[0]+4,value:e,key:null})}function $n(){var e=this;var i=this.__execs__.canvas;var r=this.__execs__.field;var n=this.innerSize();var a=this.__execs__.scale;var s=this.__execs__.axis;var o=s&&s.x?s.x[r.x.field()]:null;var l=s&&s.y?s.y[r.y.field()]:null;var c=t.brush().extent([[0,0],[n.width,n.height]]);var u=i.selectAll(".brush.x").data([n]);u.exit().remove();u=u.enter().append("g").attr("class","brush x").merge(u).attr("transform","translate("+[0,0]+")").call(c);this.brushGen(c);var h=this.zoomExtent(this.isColor(),true);var f=t.zoom().scaleExtent(h).translateExtent([[0,0],[this.width(),this.height()]]);i.call(f);this.zoomGen(f);var d=a.x.domain();var v=a.y.domain();var _=void 0;c.on("end.scatter",function(){if(t.event.sourceEvent&&t.event.sourceEvent.type==="end")return;var i=t.event.selection;if(!i){if(!_)return _=setTimeout(function(){_=null},300);a.x.domain(d);a.y.domain(v)}else{a.x.domain([i[0][0],i[1][0]].map(a.x.invert,a.x));a.y.domain([i[1][1],i[0][1]].map(a.y.invert,a.y))}if(o){o.render(null)}if(l){l.render(null)}Yn.call(e);e.brushMove(u,null)})}function ta(){var e=this;var i=this.parent();var r=this.zoomExtent(this.isColor(),true);var n=t.zoom().scaleExtent(r).translateExtent([[0,0],[this.width(),this.height()]]);this.__execs__.canvas.call(n);this.zoomGen(n).zoomed(function(){Yn.call(e,true);t.select((i?i:e).__execs__.canvas.node().parentNode.parentNode).selectAll(u("tooltip",true)).remove();Qn.call(e)},true)}function ea(){if(!this.zoom())return;if(this.zoom()==="normal")ta.call(this);else if(this.zoom()==="brush")$n.call(this)}var ia={range:[3,12],scale:"linear",reverse:false};var ra=["normal","color","bubble","mixed"];var na={regionPadding:.1,size:ia};var aa=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(na);return t}r(e,[{key:"isColor",value:function t(){return this.condition()===ra[1]||this.condition()===ra[3]}},{key:"isSized",value:function t(){return this.condition()===ra[2]||this.condition()===ra[3]}},{key:"isFacet",value:function t(){return this.facet()&&this.isColor()}},{key:"muteFromLegend",value:function t(e){this.muteRegions(e.key)}},{key:"demuteFromLegend",value:function t(e){this.demuteRegions(e.key)}},{key:"muteToLegend",value:function t(e){this.muteLegend(e.parent.data.key)}},{key:"demuteToLegend",value:function t(e){this.demuteLegend(e.parent.data.key)}},{key:"renderLayout",value:function t(e){this.reset(e);this.renderFrame();Gn.call(this);Xn.call(this,e);this.renderCanvas(this.size().range[this.isSized()?1:0]*1.25);Jn.call(this);Un.call(this);Kn.call(this);if(this.isFacet()){qn.call(this)}else{Yn.call(this)}Wn.call(this);Qn.call(this);ea.call(this)}}]);return e}(x(sr).with(Ir,Pr,Qr,lr));var sa=b(aa);function oa(){var t=function t(e,i){var r=this.__execs__.field;if(e.length!==2)throw new A;var n=gr(e[0]);var a=gr(e[1]);if(this.reverse()){r.x=a;r.y=n}else{r.x=n;r.y=a}if(e.length===2){if(i.length===0)this.measure(B);r.color=G(i[0]);if(i.length===0)return va[1];else if(i.length===1)return va[0]}else throw new A};this.condition(t);this.__execs__.munged=this.aggregate(this.reverse(),true);this.limitKeys()}function la(){var e=this.scale();var i=this.__execs__.munged;var r=this.__execs__.field;var n=this.axisX();var a=this.axisY();var s=void 0,o=void 0,l=void 0;e.x=t.scaleBand();e.y=t.scaleBand();e.color=t.scaleLinear();o=r.x.munged(i).level(0).domain();s=r.y.munged(i).level(1).domain();l=r.color.munged(i).level(1).domain();r.x.axis(n);r.y.axis(a);e.x.domain(o);e.y.domain(s);this.thickness(a,e.y,false,true);this.thickness(n,e.x,true,true);var c=this.innerSize();e.x.rangeRound([0,c.width]).padding(this.padding());e.y.rangeRound([0,c.height]).padding(this.padding());if(y(l)){e.color.domain([l[0],0,l[l.length-1]])}e.color.domain(l).range(this.color())}function ca(){var e=this;var i=this.__execs__.canvas;var r=this.__execs__.scale;var n=this.label();var a=t.transition().duration(this.transition().duration).delay(this.transition().delay);var s=function t(e){return r.y(e.data.key)};var o=function t(e){return r.color(e.value)};var l=function t(e){return c(e.value)};var u=function t(e){var i=r.x.bandwidth();var n=r.y.bandwidth();e.each(function(t){t.x=0;t.y=s(t);t.value=t.value;t.color=o(t);t.text=l(t);t.w=i;t.h=n})};var h=function t(e){e.attr("width",function(t){return t.w}).attr("height",function(t){return t.h}).style("stroke","none").style("fill",function(t){return t.color}).style("cursor","pointer")};var f=function t(e){e.transition(a).attr("width",function(t){return t.w}).attr("height",function(t){return t.h}).style("fill",function(t){return t.color})};var d=function i(r){r.each(function(i){var r=t.select(this);r.attr("x",0).attr("y",0).attr("dx","0.29em").attr("dy","1em").style("pointer-events","none").style("fill","#111").text(i.text);e.styleFont(r)})};var v=function i(r){r.each(function(i){var r=t.select(this);r.attr("text-anchor",i.anchor).style("visibility",n?"visible":"hidden").transition(a).text(i.text);e.styleFont(r)})};var _=function t(i){var r=i.selectAll(e.nodeName()).data(function(t){return t.children},function(t){return t.data.key});r.exit().remove();var n=r.enter().append("g").attr("class",e.nodeName(true)+" point").call(u);n.append("rect").call(h);n.append("text").call(d);r=n.merge(r).call(u);r.selectAll("rect").call(f);r.selectAll("text").call(v);r.attr("transform",function(t){return"translate("+[t.x,t.y]+")"}).style("fill",function(t){return t.color});e.__execs__.nodes=r};var p=i.selectAll(this.regionName());p.call(_)}function ua(){var t=this;var e=this.__execs__.scale;var i=this.__execs__.field;var r=function r(n){i.x.axis(n);var a=t.axisDefault(e.x,n);if(n.orient==="bottom")a.y(e.y.range()[1]);return a};var n=function r(n){i.y.axis(n);var a=t.axisDefault(e.y,n);if(n.orient==="right")a.x(e.x.range()[1]);return a};var a=this.axisX();var s=this.axisY();if(a){r(a)}if(s){n(s)}this.renderAxis()}function ha(){this.renderSpectrum()}function fa(){var t=this.__execs__.scale;var e=function e(i){i.x=t.x(i.data.key);i.y=0};this.renderRegion(e)}function da(){if(!this.tooltip())return;var t=this.__execs__.field;var e=function e(i,r){return{name:t.color.field(),value:r}};var i=function t(e){return{x:e.w,y:0}};this.renderTooltip({offset:i,value:e,color:"#111"})}var va=["normal","count"];var _a={color:si,padding:.05,reverse:false};var pa=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(_a);return t}r(e,[{key:"isCount",value:function t(){return this.condition()===va[1]}},{key:"renderLayout",value:function t(){this.reset();this.renderFrame();oa.call(this);la.call(this);this.renderCanvas();fa.call(this);ua.call(this);ca.call(this);ha.call(this);da.call(this)}}]);return e}(x(er).with(lr));pa.prototype.reverse=d("reverse");var ga=b(pa);function ma(){var e=this;var i=function t(e,i){var r=this.__execs__.field;if(e.length===0)throw new A;if(this.shape()==="word"&&e.length>1)throw new A;r.root=gr(e[0]);r.leaf=gr(e[e.length-1]);if(i.length===1){r.color=G(i[0]);return Aa[0]}else if(i.length===0){this.measure(B);r.color=G(i[0]);return Aa[1]}else throw new A};this.condition(i);this.__execs__.munged=this.aggregate(false,true,true,false);var r=t.hierarchy({key:"root",values:this.__execs__.munged},function(t){return t.values}).sum(function(t){return t.value?t.value[e.measureName()]:0});if(this.sortByValue()==="ascending"){r.sort(function(t,e){return t.value-e.value})}else if(this.sortByValue()==="descending"){r.sort(function(t,e){return e.value-t.value})}var n=this.size()?this.size().range:this.innerSize(true);if(this.shape()==="pack"){var a=t.pack().size(n);r=a(r)}else{var s=t.treemap().size(n).paddingTop(this.font()["font-size"]+4);r=s(r)}this.__execs__.munged=r}function ya(){var e=this.scale();var i=this.__execs__.munged;var r=t.extent(i.leaves(),function(t){return t.value});e.color=t.scaleLinear().domain(r);if(y(r)){e.color.domain([r[0],0,r[r.length-1]])}e.color.domain(r).range(this.color())}var xa="#eee";function ka(){var e="treemap-node-clip-path-";var i=this;var r=this.__execs__.mark;var n=this.__execs__.scale;var a=this.label();var s=t.transition().duration(this.transition().duration).delay(this.transition().delay);var o=this.size();var l=this.shape();var h=this.innerSize();var f=l==="pack"?"circle":"rect";var d=function t(e){if(f==="rect"){e.attr("width",function(t){return t.w}).attr("height",function(t){return t.h})}else{e.attr("r",function(t){return t.r})}};var v=function t(e){if(l==="treemap"){e.attr("dx","0.29em").attr("dy","1em")}else if(l==="word"){var i=e.datum();var r=i.w<i.h;e.attr("dy",r?"-.35em":".8em").attr("textLength",r?i.h:i.w).attr("lengthAdjust","spacingAndGlyphs").attr("transform",r?"rotate(90)":"").style("font-size",(r?i.w:i.h)-1+"px").style("fill",i.color).style("pointer-events","all").style("cursor","pointer")}else{var n=e.datum();e.attr("visibility",n.children?"hidden":"visible").attr("text-anchor","middle").attr("dy",".35em")}};var _=function t(e){return e.children?xa:n.color(e.value)};var p=function t(e){return c(e.value)};var g=function t(e){var i=0;var r=0;if(o||l==="pack"){i=(h.width-o.range[0])/2;r=(h.height-o.range[1])/2}e.each(function(t){t.color=_(t);t.text=p(t);if(l!=="pack"){t.x=t.x0+i;t.y=t.y0+r;t.w=t.x1-t.x0;t.h=t.y1-t.y0}else{t.x+=i/2;t.y+=r/2}})};var y=function i(r){r.each(function(i){t.select(this).attr("id",m(e)).append(f).call(d,i)})};var x=function e(i){i.each(function(e){t.select(this).select(f).transition(s).call(d,e)})};var k=function t(e){e.style("visibility",l==="word"?"hidden":"visible").style("stroke","none").style("fill",function(t){return t.color}).style("cursor","pointer").call(d)};var b=function t(e){e.style("visibility",l==="word"?"hidden":"visible").transition(s).style("fill",function(t){return t.color}).style("stroke",function(t){return t.children?"#ddd":"none"}).call(d)};var w=function e(n){n.each(function(){var e=r.get(this);var n=t.select(this);n.attr("x",0).attr("y",0).style("pointer-events","none").style("fill","#000").text(function(t){return t.data.key});i.styleFont(n);n.call(v,e);n.style("font-weight","bold")})};var z=function e(n){n.each(function(){var e=t.select(this);e.text(function(t){return t.data.key});i.styleFont(e);e.style("font-weight","bold");e.call(v,r.get(this))})};var A=function e(r){r.each(function(e){var r=t.select(this);var n=r.attr("x",0).attr("y",0).style("pointer-events","none").style("fill","#111").text(e.text);if(f==="rect"){n.attr("dx","0.29em").attr("dy","2em")}else{n.attr("visibility",e.children?"hidden":"visible").attr("text-anchor","middle").attr("dy","1.35em")}i.styleFont(r)})};var N=function e(r){r.each(function(e){var r=t.select(this);r.style("visibility",a&&l!=="word"?"visible":"hidden").transition(s).text(e.text);i.styleFont(r)})};var F=function e(r){var n=r.selectAll(i.nodeName()).data(function(t){return t.descendants().slice(1)},function(t){return t.data.key});n.exit().remove();var a=n.enter().append("g").attr("class",function(t){return i.nodeName(true)+" "+u(t.children?"stem":"leaf")}).call(g);a.append("defs").append("clipPath").call(y);a.append(f).attr("class","shape").call(k);a.append("text").attr("class","name").call(w);a.filter(function(t){return!t.children}).append("text").attr("class","label").call(A);a.attr("clip-path",function(){return"url(#"+t.select(this).select("clipPath").attr("id")+")"});n=a.merge(n).call(g);n.select("defs").select("clipPath").call(x);n.selectAll(".shape").call(b);n.selectAll(".name").call(z);n.selectAll(".label").call(N);n.attr("transform",function(t){return"translate("+[t.x,t.y]+")"});i.__execs__.nodes=n};this.renderRegion(function(t){t.x=0;t.y=0},function(t){return[t]}).call(F)}function ba(){this.renderSpectrum()}function wa(){if(!this.tooltip())return;var t=this.__execs__.field;var e=this.isCount();var i=this.shape();var r=function t(e){return{name:"key",value:e.data.key}};var n=function i(r,n){var a=void 0;if(e){a=P}else{a=t.color.field()}return{name:a,value:n}};var a=function t(e){return{x:i==="pack"?e.r:e.w,y:0}};this.renderTooltip({offset:a,value:n,key:r,color:"#111"},false,true)}var za=["treemap","pack","word"];var Aa=["normal","count"];var Na={color:si,reverse:false,shape:za[0],size:null,sortByValue:"natural"};var Fa=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(Na);return t}r(e,[{key:"axis",value:function t(){if(!arguments.length)return[];return this}},{key:"isCount",value:function t(){return this.condition()===Aa[1]}},{key:"renderLayout",value:function t(){this.reset();this.renderFrame();ma.call(this);ya.call(this);this.renderCanvas();ka.call(this);ba.call(this);wa.call(this)}}]);return e}(x(ci).with(en,fr));Fa.prototype.reverse=d("reverse");var Ta=b(Fa);function Oa(t,e){var i=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;return t.map(function(t){return e.map(function(e){return{data:{x:e.field,y:(i?t.data:t)[e.field]}}})})}function Sa(){var t=this;var e=function t(e,i){var r=this;var n=this.__execs__.field;if(i.length<2)throw new A;n.x=gr(this.mixedDimension());i.forEach(function(t){n[Za(t)]=G(t);if(r.shape()===Ya[1])n[qa(t)]=G(t)});if(e.length===0)return Ja[0];else if(e.length===1){n.region=gr(e[0]);return Ja[1]}else throw new A};this.condition(e);var i=void 0;var r=this.measures();this.limitRows();if(this.shape()===Ya[0]){if(this.isColor()){i=this.aggregate(false,false);i.forEach(function(t){t.key=t.data.key;t.children=Oa(t.children,r,true)})}else{i=[{parent:null,children:Oa(this.data(),r)}]}}else{i=[];r.forEach(function(e){r.forEach(function(r){i.push({xField:e,yField:r,children:t.data()})})})}this.__execs__.munged=i}function Ma(t,e){var i=[];t.forEach(function(t){t=t[e.field()];if(e.interval()){t=w[e.interval()](t)}if(t instanceof Date&&i.findIndex(function(e){return e-t===0})<0)i.push(t);else if(!i.includes(t))i.push(t)});i.sort(O(e.order()));return i}function La(e){var i=this;var r=this.scale();var n=this.measures();var a=this.__execs__.munged;var s=this.innerSize();var o=this.__execs__.field;if(this.isColor()){var l=o.region.munged(a).domain();r.color=this.updateColorScale(l,e)}r.x=t.scalePoint().domain(n.map(function(t){return t.field})).rangeRound([0,s.width]);n.forEach(function(e){var n=t.extent(i.data(),function(t){return t[e.field]});var a=Za(e);r[a]=L(n,null,o[a]).rangeRound([s.height,0]);i.setCustomDomain(a,n)})}function Da(e){var i=this;var r=this.scale();var n=this.measures();var a=this.innerSize();var s=this.__execs__.field;if(this.isColor()){var o=Ma(this.data(),s.region);r.color=this.updateColorScale(o,e)}var l=Math.min(a.width,a.height);r.region=t.scaleBand().domain(n.map(function(t){return t.field})).rangeRound([0,l]).padding(this.regionPadding());n.forEach(function(e){var n=t.extent(i.data(),function(t){return t[e.field]});var a=Za(e);r[a]=L(n).rangeRound([r.region.bandwidth(),0]);i.setCustomDomain(a,n);var s=qa(e);r[s]=L(n).rangeRound([0,r.region.bandwidth()]);i.setCustomDomain(s,n)})}function Ea(t){if(this.shape()===Ya[0])La.call(this,t);else Da.call(this,t)}function Ca(){var e=this;var i=this.__execs__.canvas;var r=this.__execs__.scale;var n=this.size();var a=this.innerSize();var s=t.transition().duration(this.transition().duration).delay(this.transition().delay);var o=t.line().x(function(t){return r.x(t.data.x)}).y(a.height);var l=t.line().x(function(t){return r.x(t.data.x)}).y(function(t){return r[Za(t.data.x)](t.data.y)});var c=function t(e){e.attr("d",o).attr("fill","none").attr("stroke-width",n.range[0])};var h=function t(e){e.transition(s).attr("d",l).attr("stroke-width",n.range[0])};var f=function t(i){var r=i.selectAll(e.seriesName()).data(function(t){return t.children},function(t,e){return t.key?t.key:e});r=r.enter().append("g").attr("class",e.seriesName(true)).merge(r);var n=r.selectAll("path"+u("line",true)).data(function(t){return[t]});n.enter().append("path").attr("class",u("line")).call(c).merge(n).call(h)};var d=i.selectAll(this.regionName());d.call(f)}function ja(){var t=this;var e=this.measures();var i=this.__execs__.scale;var r=function e(r,n){var a=t.axisDefault(r,n);if(n.orient==="right")a.x(i.x.range()[1]);a.x(i.x(n.field));return a};var n=this.axisY();if(n){e.forEach(function(t){var e=Za(t);var a=i[e];var s={target:n.target,field:t.field,orient:n.orient,showDomain:true,titleOrient:"bottom",showTitle:true};r(a,s)})}}function Ra(){if(this.shape()===Ya[0]){ja.call(this)}this.renderAxis()}function Pa(){if(!this.isColor()){return}this.renderLegend()}function Ba(){var t=this.isColor();var e=this.color();var i=this.shape();var r=this.__execs__.scale;var n=function n(a){if(i===Ya[0]){a.x=0;a.y=0;a.color=t?r.color(a.data.key):e[0]}else{a.x=r.region(a.xField.field);a.y=r.region.range()[1]-r.region(a.yField.field)-r.region.bandwidth()}};this.renderRegion(n,function(t){return t},i===Ya[1],i===Ya[1]?".matrix":"").style("stroke",function(t){return t.color})}function Ia(){var t=this;var e=this;var i=this.__execs__.scale;var r=this.__execs__.canvas;var n=this.measures();var a=this.dimensions();var s=i.region.bandwidth();var o=["axisTitles","color","size","grid","font","label"].map(function(e){return{key:e,value:t[e]()}});var l=function t(i,r){var l=sa().container(this).data(i.children).dimensions(a).measures([i.xField,i.yField]).width(s).height(s).legend(false).tooltip(false).parent(e).zeroOffset(true).noAxisOffset(true);var c=r%n.length===0;var u=r<n.length;o.forEach(function(t){return l[t.key](t.value)});l.axis({target:"y",orient:"left",showTitle:u,showTicks:u});l.axis({target:"x",orient:"bottom",showTitle:c,showTicks:c});l.render()};r.selectAll(".facet").each(l)}function Ha(){var i=this.__execs__.canvas;var r=this.__execs__.scale;var n=this.innerSize();var a=this.measures();var s={};var o=this.font()["font-size"];var l=t.brushY().extent([[-o,0],[o,n.height]]);var c=i.selectAll(this.seriesName());var u=function t(){c.attr("opacity","1").filter(function(t){var i=function e(i){var r=s[i];var n=t.filter(function(t){return t.data.x===i})[0];var a=n.data.y<r[1]||n.data.y>r[0];if(a)return{v:true}};for(var r in s){var n=i(r);if((typeof n==="undefined"?"undefined":e(n))==="object")return n.v}return false}).attr("opacity",.1)};var h=i.selectAll(".brush.y").data(a,function(t){return t.field});h.exit().remove();h.enter().append("g").attr("class","brush y").merge(h).attr("transform",function(t){return"translate("+[r.x(t.field),0]+")"}).call(l);l.on("brush.parCoords",function(e){s[e.field]=t.event.selection.map(r[Za(e.field)].invert);u()}).on("end.parCoords",function(e){if(t.event.selection===null){delete s[e.field];u()}});this.brushGen(l)}function Va(){var e=this.__execs__.canvas;var i=this.__execs__.scale;var r=i.region.bandwidth();var n=t.brush().extent([[0,0],[r,r]]);var a=e.selectAll(this.nodeName());var s=void 0;var o=e.selectAll(".brush.matrix").data(function(t){return t});o.exit().remove();o.enter().append("g").attr("class","brush matrix").merge(o).attr("transform",function(t){return"translate("+[i.region(t.xField.field),i.region.range()[1]-i.region(t.yField.field)-i.region.bandwidth()]+")"}).call(n);n.on("start.matrix",function(){if(s!==this){t.select(s).call(n.move,null);s=this}}).on("brush.matrix",function(e){if(t.event.selection===null)return;var r=e.xField.field;var n=e.yField.field;var s=i[qa(r)];var o=i[Za(n)];var l=t.event.selection.map(function(t){return[s.invert(t[0]),o.invert(t[1])]});a.attr("opacity",1).filter(function(t){t=t.data;return t[r]<l[0][0]||t[r]>l[1][0]||t[n]>l[0][1]||t[n]<l[1][1]}).attr("opacity",.1)}).on("end.matrix",function(){if(t.event.selection===null){a.attr("opacity",1)}});this.brushGen(n)}function Ga(){if(this.shape()===Ya[0]){Ha.call(this)}else{Va.call(this)}}var Xa={range:[1,1],scale:"linear",reverse:false};var Ya=["par-coords","scatter-matrix"];var Ja=["normal","color"];var Wa={regionPadding:.1,size:Xa,shape:Ya[0]};var Ka=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(Wa);t.brush(true);return t}r(e,[{key:"isColor",value:function t(){return this.condition()===Ja[1]}},{key:"muteRegions",value:function t(e){var i=this;var r=function t(e){i.mute(e,i.muteIntensity())};var n=function t(e){var r=e.selectAll(i.nodeName()).classed("mute",true);i.mute(r,i.muteIntensity())};if(!arguments.length){if(this.shape()===Ya[0]){return this.filterRegions().call(r)}else{return this.regions().selectAll(this.regionName()).call(n)}}if(this.shape()===Ya[0]){return this.filterRegions(Q(e),true).call(r)}else{return this.regions().selectAll(this.regionName()).filter(Q(e)).call(n)}}},{key:"demuteRegions",value:function t(e){var i=this;var r=function t(e){i.demute(e)};var n=function t(e){var r=e.selectAll(i.nodeName());i.demute(r)};if(!arguments.length){if(this.shape()===Ya[0]){return this.filterRegions().call(r)}else{return this.regions().selectAll(this.regionName()).call(n)}}if(this.shape()===Ya[0]){return this.filterRegions(Q(e),true).call(r)}else{return this.regions().selectAll(this.regionName()).filter(Q(e)).call(n)}}},{key:"muteFromLegend",value:function t(e){this.muteRegions(e.key)}},{key:"demuteFromLegend",value:function t(e){this.demuteRegions(e.key)}},{key:"renderLayout",value:function t(e){if(this.shape()===Ya[0]&&this.axisX()){var i=this.axis().findIndex(function(t){return t.target==="x"});if(i>=0){this.axis().splice(i,1)}}this.reset(e);this.renderFrame();Sa.call(this);Ea.call(this,e);this.renderCanvas();Ra.call(this);if(this.shape!==Ya[0]||this.isColor())Ba.call(this);if(this.shape()===Ya[0]){Ca.call(this)}else{Ia.call(this)}Pa.call(this);Ga.call(this)}}]);return e}(x(er).with(Xr,Pr,lr,en));function qa(t){return"x-"+(t.field?t.field:t)}function Za(t){return"y-"+(t.field?t.field:t)}var Ua=b(Ka);function Qa(){var e=function t(e,i){var r=this.__execs__.field;if(e.length===1){if(i.length===0)this.measure(B);r.r=G(i[0]);r.region=gr(e[0]);if(i.length===0)return ns[0];else if(i.length===1)return ns[1]}else throw new A};this.condition(e);this.__execs__.munged=this.aggregate(false,true,false,false);this.limitKeys();var i=this.__execs__.field;var r=t.pie().value(function(t){return t.value[i.r.valueName()]}).padAngle(this.padding()).sortValues(null);var n=r(this.__execs__.munged);n.forEach(function(t){return t.key=t.data.key});if(i.region.interval()){n.forEach(function(t){t.data.key=new Date(t.data.key)})}this.__execs__.munged=n}function $a(t){var e=this.scale();var i=this.__execs__.munged;var r=this.__execs__.field;var n=r.region.munged(i).domain();e.color=this.updateColorScale(n,t)}function ts(){var e=this;var i=this.__execs__.scale;var r=this.label();var n=t.transition().duration(this.transition().duration).delay(this.transition().delay);var a=this.innerSize();var s=this.size();var o=t.arc().innerRadius(s.range[0]).outerRadius(s.range[1]).startAngle(function(t){return t.startAngle}).endAngle(function(t){return t.endAngle}).padAngle(function(t){return t.padAngle});var l=function e(i){var r=t.interpolate({endAngle:0},i);return function(t){return o(r(t))}};var u=function e(r){var n=t.mean(s.range);r.each(function(t){t.mid=(t.endAngle+t.startAngle)/2;t.dx=Math.sin(t.mid)*n;t.dy=-Math.cos(t.mid)*n;t.x=a.width/2+t.dx;t.y=a.height/2+t.dy;t.color=i.color(t.key);t.text=c(t.value)})};var h=function t(e){e.style("fill",function(t){return t.color}).style("cursor","pointer")};var f=function t(e){e.style("fill",function(t){return t.color}).transition(n).attrTween("d",l)};var d=function i(r){r.each(function(i){t.select(this).attr("x",i.dx).attr("dy",".35em").attr("y",i.dy).attr("text-anchor","middle").style("pointer-events","none").text(i.text);e.styleFont(t.select(this))})};var v=function i(a){a.each(function(i){t.select(this).style("visibility",r?"visible":"hidden").text(i.text).transition(n).attr("x",i.dx).attr("y",i.dy);e.styleFont(t.select(this))})};var _=function t(i){var r=i.selectAll(e.nodeName()).data(function(t){return t},function(t){return t.data.key});r.exit().remove();var n=r.enter().append("g").attr("class",e.nodeName(true)+" pie").call(u);n.append("path").call(h);n.append("text").call(d);r.call(u);r=n.merge(r).attr("transform","translate("+[a.width/2,a.height/2]+")");r.select("path").call(f);r.select("text").call(v);e.__execs__.nodes=r};this.renderRegion(function(t){t.x=0;t.y=0},function(t){return[t]}).call(_)}function es(){if(!this.legend())return;this.renderLegend()}function is(){if(!this.tooltip())return;var t=this.isCount();var e=this.__execs__.field;var i=function t(i){var r=e.region.isInterval()?e.region.format():null;return r?r(i):i};var r=function t(e){return{name:"key",value:i(e.data.key)}};var n=function i(r,n){var a=void 0;if(t){a=P}else{a=e.region.field()}return{name:a,value:n}};this.renderTooltip({value:n,key:r})}var rs={range:[0,150],scale:"linear",reverse:false};var ns=["normal","count"];var as={limitKeys:20,padding:0,size:rs};var ss=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(as);return t}r(e,[{key:"axis",value:function t(){if(!arguments.length)return[];return this}},{key:"muteFromLegend",value:function t(e){this.muteNodes(e.key)}},{key:"demuteFromLegend",value:function t(e){this.demuteNodes(e.key)}},{key:"muteToLegend",value:function t(e){this.muteLegend(e.data.key)}},{key:"demuteToLegend",value:function t(e){this.demuteLegend(e.data.key)}},{key:"isCount",value:function t(){return this.condition()===ns[1]}},{key:"renderLayout",value:function t(e){this.reset(e);this.renderFrame();Qa.call(this);$a.call(this,e);this.renderCanvas();ts.call(this);es.call(this);is.call(this)}}]);return e}(x(ci).with(lr));var os=b(ss);function ls(){var t=function t(e,i){var r=this.__execs__.field;if(this.addr()){if(i.length<1)throw new A;r.addr=i[0];r.lat=vs;r.lng=_s;if(i.length===2){r.radius=i[1];return gs[0]}else if(i.length===1){return gs[1]}}else{if(i.length<2)throw new A;if(i.length===3){r.lat=i[0];r.lng=i[1];r.radius=i[2];return gs[0]}else if(i.length===2){r.lat=i[0];r.lng=i[1];return gs[1]}}if(e.length===1){r.name=e[0]}throw new A};this.condition(t);this.limitRows();var e=this.__execs__.field;if(this.isSized())this.data().sort(function(t,i){return i[e.radius.field]-t[e.radius.field]});this.__execs__.munged=this.data()}function cs(e){e=t.select(e);var i=e.select(".frame.layer");if(i.empty()){i=e.append("div").attr("class","frame layer")}i.style("width",this.width()+"px").style("height",this.height()+"px");var r={center:new daum.maps.LatLng(33.450701,126.570667),level:3};var n=new daum.maps.Map(i.node(),r);n.setMapTypeId(daum.maps.MapTypeId[this.mapBaseType()]);if(this.overlayMapType())n.addOverlayMapTypeId(daum.maps.MapTypeId[this.overlayMapType()]);var a=new daum.maps.ZoomControl;n.addControl(a,daum.maps.ControlPosition.RIGHT);n.setZoomable(false);this.__execs__.map=n}function us(){var e=this.scale();var i=this.__execs__.field;if(this.isSized()){var r=t.extent(this.data(),function(t){return t[i.radius.field]});e.r=t.scaleLinear().domain(r.map(function(t){return Math.sqrt(t)}))}}function hs(t,e,i){e.addr2coord(t,function(t,e){if(t===daum.maps.services.Status.OK){return i(null,e.addr[0])}else{return i(t)}})}function fs(t,e,i){var r=Math.pow(2,e);t.range([i.range[0]*r,i.range[1]*r])}function ds(){var t=this.__execs__.map;var e=this.__execs__.field;var i=this.__execs__.scale;var r=this.__execs__.dispatch;var n=this.addr();var a=this.label();var s=this.data();var o=this.isSized();var l=this.size();var u=this.color();var h=new daum.maps.services.Geocoder;var f=[];var d=function r(){var n=s.map(function(t){return new daum.maps.LatLng(t[e.lat.field],t[e.lng.field])});var a=new daum.maps.LatLngBounds;n.forEach(function(t){a.extend(t)});t.setBounds(a);var c=t.getLevel();if(o)fs(i.r,c,l)};var v=function r(){var h=t.getLevel();var d=111111;s.forEach(function(r){var s=new daum.maps.LatLng(r[e.lat.field],r[e.lng.field]);var v=o?i.r(Math.sqrt(r[e.radius.field])):l.range[0]*Math.pow(2,h);var _={clickable:true,zIndex:10,center:s,radius:v,strokeColor:u[0],strokeWeight:1.5,strokeOpacity:1,strokeStyle:"solid",fillColor:u[0],fillOpacity:.5};var p=new daum.maps.Circle(_);p.setMap(t);f.push(p);var g=e.name?r[e.name.field]:n?r[e.addr.field]:"Y: "+c(r[e.lat.field])+"</br> X: "+c(r[e.lng.field]);var m='<div class="jelly-chart-tooltip" style="padding:4px;font-size:12px;font-family:sans-serif;">'+'<div class="jelly-chart-key" style="font-weight:bold;">'+g+"</div>"+(o?'<div class="jelly-chart-value">'+e.radius.field+": "+c(r[e.radius.field])+"</div>":"")+"</div>";var y=new daum.maps.InfoWindow({position:new daum.maps.LatLng(r[e.lat.field]+v/d,r[e.lng.field]),content:m});daum.maps.event.addListener(p,"mouseover",function(){y.open(t)});daum.maps.event.addListener(p,"mouseout",function(){y.close()});if(o&&a){var x=c(r[e.radius.field]);var k=new daum.maps.CustomOverlay({position:s,clickable:true,zIndex:-1,content:'<div class="label" style="pointer-events:none;padding:4px;font-size:12px;font-family:sans-serif;">'+x+"</div>"});k.setMap(t)}})};if(n){var _=0;s.forEach(function(t){var i=t[e.addr.field];var n=function e(i,n){if(!i){t[vs.field]=n.lat;t[_s.field]=n.lng}_+=1;r.call("loading",this,_);if(_===s.length){d();v();r.call("end")}};try{hs(i,h,n)}catch(t){n(t)}})}else{d();v()}if(!o){daum.maps.event.addListener(t,"zoom_changed",function(){var e=l.range[0]*Math.pow(2,t.getLevel());f.forEach(function(t){t.setRadius(e)})})}}var vs={field:"__--jelly-lat--__"};var _s={field:"__--jelly-lng--__"};var ps={range:[.5,4],scale:"linear",reverse:false};var gs=["normal","point"];var ms={addr:false,mapBaseType:"ROADMAP",overlayMapType:null,size:ps};var ys=function(e){a(n,e);function n(){i(this,n);var e=s(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));e.setAttrs(ms);e.__execs__.dispatch=t.dispatch("loading","end");h(e,e.__execs__.dispatch);return e}r(n,[{key:"isSized",value:function t(){return this.condition()===gs[0]}},{key:"renderLayout",value:function t(){this.reset();ls.call(this);us.call(this);cs.call(this,this.container());ds.call(this)}}]);return n}(ci);ys.prototype.addr=d("addr");ys.prototype.mapBaseType=d("mapBaseType");ys.prototype.overlayMapType=d("overlayMapType");var xs=b(ys);function ks(){var t=this;var e=this.__execs__.scale;var i=this.axisX();var r=this.axisY();var n=this.__execs__.field;var a=function i(r){r.field=n.x.field();var a=t.axisDefault(e["x-bar"],r);if(r.orient==="bottom")a.y(e["y-bar"].range()[0]);return a};var s=function i(r,n){var a=t.axisDefault(r,n);if(n.orient==="right")a.x(e["x-bar"].range()[1]);return a};if(i){a(i)}if(r){s(e["y-bar"],{target:r.target,field:n.yBar.field(),orient:"left"});s(e["y-line"],{target:r.target,field:n.yLine.field(),orient:"right"})}this.renderAxis()}function bs(){var t=function t(e,i){var r=this.__execs__.field;if(e.length===1&&i.length===2){r.x=gr(e[0]);r.yBar=G(i[0]);r.yLine=G(i[1]);r.region=gr(this.mixedDimension());return Os[0]}else throw new A};this.condition(t);this.__execs__.munged=this.data()}function ws(t){var e=this.axisY();if(e){this.axis({target:"y",orient:"right"})}var i=this.scale();i.color=this.updateColorScale(this.measures().map(function(t){return t.field}),t)}function zs(){var t=this.__execs__.scale;this.renderRegion(function(t){return t.x=t.y=0},t.color.domain().map(function(t){return{key:t}}))}function As(){var t=this.legend();if(!t)return;this.renderLegend()}function Ns(){var e=this;var i=this;var r=this.data();var n=this.__execs__.scale;var a=this.__execs__.field;var s=this.color();var o=this.innerSize();var l=o.width,c=o.height;var u=this.padding();var h=this.dimensions();var f=[a.yBar.toObject()];var d=["axisTitles","padding","font","label","grid"].map(function(t){return{key:t,value:e[t]()}});var v=[a.yLine.toObject()];var _=["axisTitles","curve","point","pointRatio","regionPadding","size","grid","font","label"].map(function(t){return{key:t,value:i[t]()}});var p=function t(){var e=Vn().container(this).data(r).dimensions(h).measures(v).width(l).height(c).legend(false).tooltip(false).padding(u).parent(i).zeroOffset(true).color(s[1]).scaleBandMode(true);_.forEach(function(t){return e[t.key](t.value)});e.render();n["x-line"]=e.scale("x");n["y-line"]=e.scale("y")};var g=function t(){var e=Er().container(this).data(r).dimensions(h).measures(f).width(l).height(c).padding(u).legend(false).tooltip(false).zeroOffset(true).parent(i).color(s[0]);d.forEach(function(t){e[t.key](t.value)});e.render();n["x-bar"]=e.scale("x");n["y-bar"]=e.scale("y")};this.regions().each(function(e,i){if(i===0)t.select(this).each(g);else t.select(this).each(p)})}function Fs(){if(!this.tooltip())return;var t=this.__execs__.field;var e=function t(e){return{name:"key",value:e.data.key}};var i=function e(i,r){var n=i.anchor?t.yLine.field():t.yBar.field();return{name:n,value:r}};this.renderTooltip({value:i,key:e})}var Ts={range:[2,2],scale:"linear",reverse:false};var Os=["normal"];var Ss={padding:.05,point:false,pointRatio:3,regionPadding:.1,size:Ts};var Ms=function(t){a(e,t);function e(){i(this,e);var t=s(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));t.setAttrs(Ss);return t}r(e,[{key:"measureName",value:function t(){var e=this.measures();var i=void 0;if(this.condition()===Os[2])i=I.field;else if(this.aggregated()&&e[0].field===I.field)i=e[0].field;else i=e[0].field+"-"+e[0].op;return i}},{key:"isCount",value:function t(){return this.condition()===Os[1]}},{key:"renderLayout",value:function t(e){this.reset(e);this.renderFrame();bs.call(this);ws.call(this,e);this.renderCanvas();zs.call(this);Ns.call(this);ks.call(this);As.call(this);Fs.call(this)}}]);return e}(x(er).with(lr,Xr));var Ls=b(Ms);var Ds={bar:Er,line:Vn,scatter:sa,xyHeatmap:ga,treemap:Ta,parCoords:Ua,pie:os,markerMap:xs,combo:Ls};Ds.type=function(t){if(Ds.hasOwnProperty(t))return Ds[t];throw new Error("Undefined type: "+t+" is not available")};return Ds});